{
	"$schema": "https://shadcn-svelte.com/schema/registry-item.json",
	"name": "data-table",
	"title": "Data Table",
	"type": "registry:block",
	"description": "Fully functional data table with sorting, filtering with many filter operators including range filters, hideable columns, sticky columns, search with prioritized 'includesString' logic, toolbar snippets, truncate logic, row select, pagination, expandable rows. Based on Tanstack Table and Shadcn Svelte. Responsive apart from filter and sort popovers.",
	"dependencies": [
		"@tanstack/table-core",
		"@lucide/svelte",
		"runed"
	],
	"devDependencies": [
		"@lucide/svelte@^0.561.0",
		"runed@^0.35.1"
	],
	"registryDependencies": [
		"badge",
		"button",
		"checkbox",
		"command",
		"data-table",
		"dropdown-menu",
		"popover",
		"select",
		"switch",
		"table"
	],
	"files": [
		{
			"content": "export { default as DataTableToolbar } from \"./data-table-toolbar.svelte\";\nexport { default as DataTableViewOptions } from \"./data-table-view-options.svelte\";\nexport { default as DataTableFilterPopover } from \"./data-table-filter-popover.svelte\";\nexport { default as DataTableSortPopover } from \"./data-table-sort-popover.svelte\";\nexport { default as DataTableColumnFilter } from \"./data-table-column-filter.svelte\";\nexport { getColumnHeaderValue } from \"./utils.js\";",
			"type": "registry:file",
			"target": "blocks/data-table/index.ts"
		},
		{
			"content": "import type { Column, Table } from \"@tanstack/table-core\";\n\n/**\n * Extracts the header value from a column definition.\n * Handles both string headers and function headers (e.g., `() => emailHeader`).\n */\nexport function getColumnHeaderValue<TData>(\n\tcolumn: Column<TData, unknown>,\n\ttable: Table<TData>\n): string {\n\tconst headerDef = column.columnDef.header;\n\n\tif (typeof headerDef === \"function\") {\n\t\ttry {\n\t\t\t// Find the corresponding header to get proper context\n\t\t\tconst headerGroups = table.getHeaderGroups();\n\t\t\tconst header = headerGroups\n\t\t\t\t.flatMap((hg) => hg.headers)\n\t\t\t\t.find((h) => h.column.id === column.id);\n\n\t\t\tif (header) {\n\t\t\t\tconst result = headerDef(header.getContext());\n\t\t\t\treturn typeof result === \"string\" ? result : column.id;\n\t\t\t}\n\n\t\t\t// Fallback: try calling with undefined (works for simple functions like () => emailHeader)\n\t\t\tconst result = headerDef(undefined as any);\n\t\t\treturn typeof result === \"string\" ? result : column.id;\n\t\t} catch {\n\t\t\treturn column.id;\n\t\t}\n\t}\n\n\treturn (headerDef as string | undefined) ?? column.id;\n}\n",
			"type": "registry:file",
			"target": "blocks/data-table/utils.ts"
		},
		{
			"content": "export type FilterOperator = \"=\" | \"<>\" | \">=\" | \"<=\" | \"~~*\" | \"in\" | \"is_null\" | \"is_not_null\" | \"between\";\n\nexport type FilterRule = {\n\tid: string;\n\toperator: FilterOperator;\n\tvalue: string | string[] | null;\n\t// For range/between operator, we need two values\n\tvalue2?: string | null;\n\t// For contains operator on dates, we need to know what part to filter\n\tdatePart?: \"day\" | \"month\" | \"year\" | null;\n\t// For contains operator on dates, the actual value to filter\n\tdatePartValue?: string | null;\n};\n\nexport type OperatorConfig = {\n\tvalue: FilterOperator;\n\tlabel: string;\n\trequiresValue: boolean; // false for null checks\n\tisFreitext: boolean; // true for free text input instead of dropdown\n\tisBetween: boolean; // true for \"von...bis\" with two inputs\n};\n\n// Operators available for string columns\nexport const STRING_OPERATORS: OperatorConfig[] = [\n\t{ value: \"=\", label: \"gleich\", requiresValue: true, isFreitext: false, isBetween: false },\n\t{ value: \"<>\", label: \"ungleich\", requiresValue: true, isFreitext: false, isBetween: false },\n\t{ value: \"~~*\", label: \"enthält\", requiresValue: true, isFreitext: true, isBetween: false },\n\t{ value: \"in\", label: \"enthalten in\", requiresValue: true, isFreitext: false, isBetween: false },\n\t{ value: \"is_null\", label: \"ist leer\", requiresValue: false, isFreitext: false, isBetween: false },\n\t{ value: \"is_not_null\", label: \"ist nicht leer\", requiresValue: false, isFreitext: false, isBetween: false },\n];\n\n// Operators available for number and date columns\nexport const NUMBER_DATE_OPERATORS: OperatorConfig[] = [\n\t{ value: \"=\", label: \"gleich\", requiresValue: true, isFreitext: false, isBetween: false },\n\t{ value: \"<>\", label: \"ungleich\", requiresValue: true, isFreitext: false, isBetween: false },\n\t{ value: \">=\", label: \"größer gleich\", requiresValue: true, isFreitext: true, isBetween: false },\n\t{ value: \"<=\", label: \"kleiner gleich\", requiresValue: true, isFreitext: true, isBetween: false },\n\t{ value: \"~~*\", label: \"enthält\", requiresValue: true, isFreitext: true, isBetween: false },\n\t{ value: \"between\", label: \"von...bis\", requiresValue: true, isFreitext: true, isBetween: true },\n\t{ value: \"in\", label: \"enthalten in\", requiresValue: true, isFreitext: false, isBetween: false },\n\t{ value: \"is_null\", label: \"ist leer\", requiresValue: false, isFreitext: false, isBetween: false },\n\t{ value: \"is_not_null\", label: \"ist nicht leer\", requiresValue: false, isFreitext: false, isBetween: false },\n];\n\n/**\n * Determines if a column is numeric or date based on sample values\n */\nexport function getColumnType<TData>(\n\tcolumn: { id: string; getFacetedUniqueValues: () => Map<unknown, number> },\n\ttable: { getRowModel: () => { rows: Array<{ getValue: (id: string) => unknown }> } }\n): \"string\" | \"number\" | \"date\" {\n\tconst uniqueValues = column.getFacetedUniqueValues();\n\tconst sampleValues = Array.from(uniqueValues.keys()).slice(0, 10);\n\n\tif (sampleValues.length === 0) {\n\t\t// Try to get a value from the table rows\n\t\tconst rows = table.getRowModel().rows;\n\t\tif (rows.length > 0) {\n\t\t\tconst firstValue = rows[0].getValue(column.id);\n\t\t\tif (firstValue !== null && firstValue !== undefined) {\n\t\t\t\tsampleValues.push(firstValue);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (sampleValues.length === 0) {\n\t\treturn \"string\"; // Default to string\n\t}\n\n\t// Check if all sample values are numbers\n\tconst allNumbers = sampleValues.every((val) => {\n\t\tif (val === null || val === undefined) return false;\n\t\tconst num = Number(val);\n\t\treturn !isNaN(num) && isFinite(num);\n\t});\n\n\tif (allNumbers) {\n\t\treturn \"number\";\n\t}\n\n\t// Check if all sample values are dates\n\tconst allDates = sampleValues.every((val) => {\n\t\tif (val === null || val === undefined) return false;\n\t\t// Check if it's a Date object or a valid date string\n\t\tif (val instanceof Date) return true;\n\t\tconst dateStr = String(val);\n\t\tconst date = new Date(dateStr);\n\t\treturn !isNaN(date.getTime()) && dateStr.length > 8; // Basic date string check\n\t});\n\n\tif (allDates) {\n\t\treturn \"date\";\n\t}\n\n\treturn \"string\";\n}\n\n/**\n * Get available operators for a column based on its type\n */\nexport function getOperatorsForColumn<TData>(\n\tcolumn: { id: string; getFacetedUniqueValues: () => Map<unknown, number> },\n\ttable: { getRowModel: () => { rows: Array<{ getValue: (id: string) => unknown }> } }\n): OperatorConfig[] {\n\tconst columnType = getColumnType(column, table);\n\tif (columnType === \"number\" || columnType === \"date\") {\n\t\treturn NUMBER_DATE_OPERATORS;\n\t}\n\treturn STRING_OPERATORS;\n}\n\n/**\n * Check if a column is a date column\n */\nexport function isDateColumn<TData>(\n\tcolumn: { id: string; getFacetedUniqueValues: () => Map<unknown, number> },\n\ttable: { getRowModel: () => { rows: Array<{ getValue: (id: string) => unknown }> } }\n): boolean {\n\treturn getColumnType(column, table) === \"date\";\n}\n\n// German month names\nexport const MONTHS = [\n\t{ value: \"1\", label: \"Januar\" },\n\t{ value: \"2\", label: \"Februar\" },\n\t{ value: \"3\", label: \"März\" },\n\t{ value: \"4\", label: \"April\" },\n\t{ value: \"5\", label: \"Mai\" },\n\t{ value: \"6\", label: \"Juni\" },\n\t{ value: \"7\", label: \"Juli\" },\n\t{ value: \"8\", label: \"August\" },\n\t{ value: \"9\", label: \"September\" },\n\t{ value: \"10\", label: \"Oktober\" },\n\t{ value: \"11\", label: \"November\" },\n\t{ value: \"12\", label: \"Dezember\" },\n];\n\n// Date part options for \"enthält\" operator\nexport const DATE_PARTS = [\n\t{ value: \"day\", label: \"Tag\" },\n\t{ value: \"month\", label: \"Monat\" },\n\t{ value: \"year\", label: \"Jahr\" },\n];\n",
			"type": "registry:file",
			"target": "blocks/data-table/filter-operators.ts"
		},
		{
			"content": "<script lang=\"ts\" generics=\"TData\">\n\timport {\n\t\ttype ColumnDef,\n\t\ttype ColumnFiltersState,\n\t\ttype PaginationState,\n\t\ttype Row,\n\t\ttype SortingState,\n\t\ttype VisibilityState,\n\t\ttype Table as TableType,\n\t\tgetCoreRowModel,\n\t\tgetFacetedRowModel,\n\t\tgetFacetedUniqueValues,\n\t\tgetFilteredRowModel,\n\t\tgetPaginationRowModel,\n\t\tgetSortedRowModel,\n\t\ttype Column,\n\t\ttype InitialTableState,\n\t\ttype ExpandedState,\n\t\tgetExpandedRowModel,\n\t\ttype ColumnSizingState,\n\t\ttype ColumnSizingInfoState,\n\t\ttype RowData,\n\t} from \"@tanstack/table-core\";\n\timport DataTableToolbar from \"./data-table-toolbar.svelte\";\n\timport DataTableColumnFilter from \"./data-table-column-filter.svelte\";\n\timport DataTablePaginationMenu from \"./data-table-pagination-menu.svelte\";\n\timport { createSvelteTable } from \"$lib/components/ui/data-table/data-table.svelte\";\n\timport FlexRender from \"$lib/components/ui/data-table/flex-render.svelte\";\n\timport * as Table from \"$lib/components/ui/table\";\n\timport { renderComponent, renderSnippet } from \"$lib/components/ui/data-table/render-helpers\";\n\timport { getColumnHeaderValue } from \"./utils.js\";\n\timport { Button, buttonVariants } from \"$lib/components/ui/button\";\n\timport ChevronRightIcon from \"@lucide/svelte/icons/chevron-right\";\n\timport ChevronLeftIcon from \"@lucide/svelte/icons/chevron-left\";\n\timport ChevronsLeftIcon from \"@lucide/svelte/icons/chevrons-left\";\n\timport ChevronsRightIcon from \"@lucide/svelte/icons/chevrons-right\";\n\timport ArrowUpIcon from \"@lucide/svelte/icons/arrow-up\";\n\timport ArrowDownIcon from \"@lucide/svelte/icons/arrow-down\";\n\timport ChevronsUpDownIcon from \"@lucide/svelte/icons/chevrons-up-down\";\n\timport SearchIcon from \"@lucide/svelte/icons/search\";\n\timport * as Select from \"$lib/components/ui/select\";\n\timport * as Popover from \"$lib/components/ui/popover\";\n\timport type { HTMLAttributes } from \"svelte/elements\";\n\timport { cn } from \"$UTILS$.js\";\n\timport Checkbox from \"$lib/components/ui/checkbox/checkbox.svelte\";\n\timport { onMount, untrack, type Snippet } from \"svelte\";\n\timport { Input } from \"$lib/components/ui/input\";\n\timport { PersistedState } from \"runed\";\n\n\tlet {\n\t\tdata,\n\t\tcolumns,\n\t\tonRowClick,\n\t\tinitialState,\n\t\trowSelection = $bindable({}),\n\t\tenableRowSelection = false,\n\t\tenableExpanding = false,\n\t\texpanded = $bindable({}),\n\t\texpandedRow,\n\t\tembeddedInParent = false,\n\t\tenableResizing = false,\n\t\tenablePagination,\n\t\tpagination = $bindable({ pageIndex: 0, pageSize: 10 }),\n\t\tenableSearch = true,\n\t\tcellClasses = \"py-2\",\n\t\trowHighlight,\n\t\tcustomElementsFirst: customElementsFirstSnippet,\n\t\tcustomElementsMiddle: customElementsMiddleSnippet,\n\t\tcustomElementsLast: customElementsLastSnippet,\n\t\tgetColumnIconSnippet,\n\t\tgetRowId,\n\t\tstoragePrefix = \"data-table\",\n\t\tinsertButton: insertButtonSnippet,\n\t}: {\n\t\tdata: TData[];\n\t\tcolumns: ColumnDef<TData>[];\n\t\tonRowClick?: (row: Row<TData>) => void;\n\t\tinitialState?: InitialTableState;\n\t\trowSelection?: Record<string, boolean>;\n\t\tenableRowSelection?: boolean;\n\t\tenableExpanding?: boolean;\n\t\texpanded?: ExpandedState;\n\t\texpandedRow?: Snippet<[Row<TData>]>;\n\t\t/**\n\t\t * Fits the table into the parent provided space\n\t\t */\n\t\tembeddedInParent?: boolean;\n\t\tenableResizing?: boolean;\n\t\tenablePagination?: boolean;\n\t\tpagination?: PaginationState;\n\t\tenableSearch?: boolean;\n\t\tcellClasses?: string;\n\t\trowHighlight?: (row: Row<TData>) => string;\n\t\tcustomElementsFirst?: Snippet<[TableType<TData>]>;\n\t\tcustomElementsMiddle?: Snippet<[TableType<TData>]>;\n\t\tcustomElementsLast?: Snippet<[TableType<TData>]>;\n\t\tgetColumnIconSnippet?: (column: any) => Snippet<[{ column: any }]> | undefined;\n\t\tgetRowId?: (originalRow: TData, index: number, parent?: Row<TData>) => string;\n\t\tstoragePrefix?: string;\n\t\tinsertButton?: Snippet<[TableType<TData>]>;\n\t} = $props();\n\n\tlet columnVisibility = new PersistedState<VisibilityState>(\n\t\t`${storagePrefix}.columnVisibility`,\n\t\t{}\n\t);\n\tlet columnFilters = new PersistedState<ColumnFiltersState>(`${storagePrefix}.columnFilters`, []);\n\tlet sorting = new PersistedState<SortingState>(\n\t\t`${storagePrefix}.sorting`,\n\t\tinitialState?.sorting ?? []\n\t);\n\tlet globalFilter = $state<any>(null);\n\tlet columnSizing = new PersistedState<ColumnSizingState>(`${storagePrefix}.columnSizing`, {});\n\tlet columnSizingInfo = $state<ColumnSizingInfoState>({});\n\tlet tableContainerRef = $state<HTMLDivElement | null>(null);\n\tlet tableBorderContainerRef = $state<HTMLDivElement | null>(null);\n\tlet searchPopoverOpen = $state(false);\n\tlet mobileSearchValue = $state(\"\");\n\n\t// Sync mobile search value with global filter when popover opens\n\t$effect(() => {\n\t\tif (searchPopoverOpen) {\n\t\t\tmobileSearchValue = typeof globalFilter === \"string\" ? globalFilter : \"\";\n\t\t}\n\t});\n\n\t/**\n\t * Custom global filter function with prioritized matching:\n\t * 1. Exact word matches (highest priority) - e.g., \"Anne\"\n\t * 2. Matches at start of word (medium-high priority) - e.g., \"Annemarie\"\n\t * 3. Matches at end of word (medium-low priority) - e.g., \"Susanne\"\n\t * 4. Matches anywhere in a word (lowest priority) - e.g., \"Hannes\"\n\t */\n\tfunction prioritizedIncludesString<TData extends RowData>(\n\t\trow: Row<TData>,\n\t\tcolumnId: string,\n\t\tfilterValue: string\n\t): number {\n\t\tif (!filterValue) return 0;\n\n\t\tconst searchValue = filterValue.toLowerCase();\n\t\t// Escape special regex characters in search value\n\t\tconst escapedSearch = searchValue.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n\n\t\t// Priority 3: Exact word match - \"anne\" as a complete word (bounded by word boundaries)\n\t\tconst exactWordRegex = new RegExp(`\\\\b${escapedSearch}\\\\b`, \"i\");\n\n\t\t// Priority 2: Match at start of word (followed by a letter, so not exact word) - \"anne\" at start like \"Annemarie\"\n\t\tconst startOfWordRegex = new RegExp(`\\\\b${escapedSearch}[a-z]`, \"i\");\n\t\t// Priority 1: Match at end of word (preceded by a letter, so not exact word) - \"anne\" at end like \"Susanne\"\n\t\tconst endOfWordRegex = new RegExp(`[a-z]${escapedSearch}\\\\b`, \"i\");\n\n\t\t// Priority 0.5: Match anywhere (but not already matched above) - \"anne\" in middle like \"Hannes\"\n\t\tconst includesRegex = new RegExp(escapedSearch, \"i\");\n\n\t\t// Check all searchable columns\n\t\tconst allColumns = row.getAllCells();\n\t\tlet maxPriority = 0;\n\n\t\tfor (const cell of allColumns) {\n\t\t\tconst cellValue = String(cell.getValue() ?? \"\").toLowerCase();\n\n\t\t\t// Priority 3: Exact word match\n\t\t\tif (exactWordRegex.test(cellValue)) {\n\t\t\t\tmaxPriority = Math.max(maxPriority, 3);\n\t\t\t}\n\t\t\t// Priority 2: Match at start of word (but not exact word)\n\t\t\telse if (startOfWordRegex.test(cellValue)) {\n\t\t\t\tmaxPriority = Math.max(maxPriority, 2);\n\t\t\t}\n\t\t\t// Priority 1: Match at end of word (but not exact word)\n\t\t\telse if (endOfWordRegex.test(cellValue)) {\n\t\t\t\tmaxPriority = Math.max(maxPriority, 1);\n\t\t\t}\n\t\t\t// Priority 0.5: Match anywhere\n\t\t\telse if (includesRegex.test(cellValue)) {\n\t\t\t\tmaxPriority = Math.max(maxPriority, 0.5);\n\t\t\t}\n\t\t}\n\n\t\treturn maxPriority;\n\t}\n\n\ttype FilterOperator =\n\t\t| \"=\"\n\t\t| \"<>\"\n\t\t| \">=\"\n\t\t| \"<=\"\n\t\t| \"~~*\"\n\t\t| \"in\"\n\t\t| \"is_null\"\n\t\t| \"is_not_null\"\n\t\t| \"between\";\n\ttype FilterValue = {\n\t\toperator: FilterOperator;\n\t\tvalue: string | string[] | null;\n\t\tvalue2?: string | null; // For \"between\" operator\n\t};\n\n\t/**\n\t * Custom column filter function that supports multiple operators:\n\t * =, <>, >=, <=, ~~*, in, is, between\n\t */\n\tfunction operatorFilterFn<TData extends RowData>(\n\t\trow: Row<TData>,\n\t\tcolumnId: string,\n\t\tfilterValue: FilterValue\n\t): boolean {\n\t\tconst { operator, value, value2 } = filterValue;\n\n\t\tconst cellValue = row.getValue(columnId);\n\t\tconst cellStr = String(cellValue ?? \"\");\n\t\tconst cellNum = Number(cellValue);\n\n\t\tswitch (operator) {\n\t\t\tcase \"=\":\n\t\t\t\tif (value === null || value === undefined) return true;\n\t\t\t\t// Try date comparison first\n\t\t\t\tconst eqDate = new Date(String(value));\n\t\t\t\tconst cellEqDate = new Date(cellValue);\n\t\t\t\tif (!isNaN(eqDate.getTime()) && !isNaN(cellEqDate.getTime())) {\n\t\t\t\t\treturn eqDate.getTime() === cellEqDate.getTime();\n\t\t\t\t}\n\t\t\t\treturn cellStr === String(value);\n\n\t\t\tcase \"<>\":\n\t\t\t\tif (value === null || value === undefined) return true;\n\t\t\t\t// Try date comparison first\n\t\t\t\tconst neDate = new Date(String(value));\n\t\t\t\tconst cellNeDate = new Date(cellValue);\n\t\t\t\tif (!isNaN(neDate.getTime()) && !isNaN(cellNeDate.getTime())) {\n\t\t\t\t\treturn neDate.getTime() !== cellNeDate.getTime();\n\t\t\t\t}\n\t\t\t\treturn cellStr !== String(value);\n\n\t\t\tcase \">=\": {\n\t\t\t\tif (value === null || value === undefined) return true;\n\t\t\t\t// Try date comparison first\n\t\t\t\tconst gteDate = new Date(String(value));\n\t\t\t\tconst cellGteDate = new Date(cellValue);\n\t\t\t\tif (!isNaN(gteDate.getTime()) && !isNaN(cellGteDate.getTime())) {\n\t\t\t\t\treturn cellGteDate >= gteDate;\n\t\t\t\t}\n\t\t\t\t// Number comparison\n\t\t\t\tconst compareNum = Number(value);\n\t\t\t\tif (!isNaN(cellNum) && !isNaN(compareNum)) {\n\t\t\t\t\treturn cellNum >= compareNum;\n\t\t\t\t}\n\t\t\t\treturn cellStr >= String(value);\n\t\t\t}\n\n\t\t\tcase \"<=\": {\n\t\t\t\tif (value === null || value === undefined) return true;\n\t\t\t\t// Try date comparison first\n\t\t\t\tconst lteDate = new Date(String(value));\n\t\t\t\tconst cellLteDate = new Date(cellValue);\n\t\t\t\tif (!isNaN(lteDate.getTime()) && !isNaN(cellLteDate.getTime())) {\n\t\t\t\t\treturn cellLteDate <= lteDate;\n\t\t\t\t}\n\t\t\t\t// Number comparison\n\t\t\t\tconst compareNum = Number(value);\n\t\t\t\tif (!isNaN(cellNum) && !isNaN(compareNum)) {\n\t\t\t\t\treturn cellNum <= compareNum;\n\t\t\t\t}\n\t\t\t\treturn cellStr <= String(value);\n\t\t\t}\n\n\t\t\tcase \"~~*\":\n\t\t\t\t// ilike operator - contains substring (case-insensitive)\n\t\t\t\t// For dates, can also filter by day/month/year\n\t\t\t\tif (value === null || value === undefined) return true;\n\t\t\t\tconst valueStr = String(value);\n\t\t\t\t// Check if it's a date part filter (format: \"day:15\" or \"month:3\" or \"year:2024\")\n\t\t\t\tif (valueStr.includes(\":\")) {\n\t\t\t\t\tconst [datePart, datePartValue] = valueStr.split(\":\");\n\t\t\t\t\tconst cellDate = new Date(cellValue);\n\t\t\t\t\tif (isNaN(cellDate.getTime())) return false; // Invalid date\n\t\t\t\t\tif (datePart === \"day\") {\n\t\t\t\t\t\treturn cellDate.getDate() === Number.parseInt(datePartValue, 10);\n\t\t\t\t\t} else if (datePart === \"month\") {\n\t\t\t\t\t\treturn cellDate.getMonth() + 1 === Number.parseInt(datePartValue, 10); // getMonth() returns 0-11\n\t\t\t\t\t} else if (datePart === \"year\") {\n\t\t\t\t\t\treturn cellDate.getFullYear() === Number.parseInt(datePartValue, 10);\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t// Regular string contains check\n\t\t\t\treturn cellStr.toLowerCase().includes(valueStr.toLowerCase());\n\n\t\t\tcase \"in\":\n\t\t\t\t// one of a list of values\n\t\t\t\tif (Array.isArray(value) && value.length > 0) {\n\t\t\t\t\treturn value.includes(cellStr);\n\t\t\t\t}\n\t\t\t\treturn false;\n\n\t\t\tcase \"between\":\n\t\t\t\t// von...bis - value is min, value2 is max\n\t\t\t\tif (value === null || value === undefined || value2 === null || value2 === undefined) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\t// Try date comparison first\n\t\t\t\tconst minDate = new Date(String(value));\n\t\t\t\tconst maxDate = new Date(String(value2));\n\t\t\t\tconst cellDate = new Date(cellValue);\n\t\t\t\tif (!isNaN(minDate.getTime()) && !isNaN(maxDate.getTime()) && !isNaN(cellDate.getTime())) {\n\t\t\t\t\treturn cellDate >= minDate && cellDate <= maxDate;\n\t\t\t\t}\n\t\t\t\t// Number comparison\n\t\t\t\tconst minNum = Number(value);\n\t\t\t\tconst maxNum = Number(value2);\n\t\t\t\tif (!isNaN(cellNum) && !isNaN(minNum) && !isNaN(maxNum)) {\n\t\t\t\t\treturn cellNum >= minNum && cellNum <= maxNum;\n\t\t\t\t}\n\t\t\t\t// String comparison fallback\n\t\t\t\tconst minStr = String(value);\n\t\t\t\tconst maxStr = String(value2);\n\t\t\t\treturn cellStr >= minStr && cellStr <= maxStr;\n\n\t\t\tcase \"is_null\":\n\t\t\t\t// checking for null/empty\n\t\t\t\treturn cellValue === null || cellValue === undefined || cellStr === \"\";\n\n\t\t\tcase \"is_not_null\":\n\t\t\t\t// checking for not null/not empty\n\t\t\t\treturn cellValue !== null && cellValue !== undefined && cellStr !== \"\";\n\n\t\t\tdefault:\n\t\t\t\treturn true;\n\t\t}\n\t}\n\n\tconst table = createSvelteTable({\n\t\tget data() {\n\t\t\treturn data;\n\t\t},\n\t\tstate: {\n\t\t\tget globalFilter() {\n\t\t\t\treturn globalFilter;\n\t\t\t},\n\t\t\tget sorting() {\n\t\t\t\treturn sorting.current;\n\t\t\t},\n\t\t\tget columnVisibility() {\n\t\t\t\treturn columnVisibility.current;\n\t\t\t},\n\t\t\tget rowSelection() {\n\t\t\t\treturn rowSelection;\n\t\t\t},\n\t\t\tget columnFilters() {\n\t\t\t\treturn columnFilters.current;\n\t\t\t},\n\t\t\tget pagination() {\n\t\t\t\treturn enablePagination ? pagination : { pageIndex: 0, pageSize: Infinity };\n\t\t\t},\n\t\t\tget expanded() {\n\t\t\t\treturn expanded;\n\t\t\t},\n\t\t\tget columnSizing() {\n\t\t\t\treturn columnSizing.current;\n\t\t\t},\n\t\t\tget columnSizingInfo() {\n\t\t\t\treturn columnSizingInfo;\n\t\t\t},\n\t\t},\n\t\tgetRowId,\n\t\tcolumnResizeMode: \"onChange\",\n\t\tinitialState,\n\t\tenableExpanding,\n\t\tglobalFilterFn: (row, columnId, filterValue) => {\n\t\t\treturn prioritizedIncludesString(row, columnId, filterValue) > 0;\n\t\t},\n\t\tdefaultColumn: {\n\t\t\tfilterFn: operatorFilterFn,\n\t\t\t...(enableResizing && {\n\t\t\t\tminSize: 100,\n\t\t\t}),\n\t\t},\n\t\tonGlobalFilterChange: (updater) => {\n\t\t\tif (typeof updater === \"function\") {\n\t\t\t\tglobalFilter = updater(globalFilter);\n\t\t\t} else {\n\t\t\t\tglobalFilter = updater;\n\t\t\t}\n\t\t},\n\t\tcolumns: enableRowSelection\n\t\t\t? [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: \"select\",\n\t\t\t\t\t\theader: ({ table }) =>\n\t\t\t\t\t\t\trenderComponent(Checkbox, {\n\t\t\t\t\t\t\t\tchecked: table.getIsAllPageRowsSelected(),\n\t\t\t\t\t\t\t\tonCheckedChange: (value) => table.toggleAllPageRowsSelected(value),\n\t\t\t\t\t\t\t\tindeterminate:\n\t\t\t\t\t\t\t\t\ttable.getIsSomePageRowsSelected() && !table.getIsAllPageRowsSelected(),\n\t\t\t\t\t\t\t\t\"aria-label\": \"Select all\",\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tcell: ({ row }) =>\n\t\t\t\t\t\t\trenderComponent(Checkbox, {\n\t\t\t\t\t\t\t\tchecked: row.getIsSelected(),\n\t\t\t\t\t\t\t\tonclick: (event) => {\n\t\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonCheckedChange: (value) => row.toggleSelected(value),\n\t\t\t\t\t\t\t\t\"aria-label\": \"Select row\",\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tenableSorting: false,\n\t\t\t\t\t\tenableHiding: false,\n\t\t\t\t\t\t...(enableResizing && {\n\t\t\t\t\t\t\tminSize: 35,\n\t\t\t\t\t\t\tsize: 35,\n\t\t\t\t\t\t\tmaxSize: 35,\n\t\t\t\t\t\t}),\n\t\t\t\t\t},\n\t\t\t\t\t...columns,\n\t\t\t\t]\n\t\t\t: columns,\n\t\tenableRowSelection,\n\t\tonExpandedChange: (updater) => {\n\t\t\tif (typeof updater === \"function\") {\n\t\t\t\texpanded = updater(expanded);\n\t\t\t} else {\n\t\t\t\texpanded = updater;\n\t\t\t}\n\t\t},\n\t\tonRowSelectionChange: (updater) => {\n\t\t\tif (typeof updater === \"function\") {\n\t\t\t\trowSelection = updater(rowSelection);\n\t\t\t} else {\n\t\t\t\trowSelection = updater;\n\t\t\t}\n\t\t},\n\t\tonSortingChange: (updater) => {\n\t\t\tif (typeof updater === \"function\") {\n\t\t\t\tsorting.current = updater(sorting.current);\n\t\t\t} else {\n\t\t\t\tsorting.current = updater;\n\t\t\t}\n\t\t},\n\t\tonColumnFiltersChange: (updater) => {\n\t\t\tif (typeof updater === \"function\") {\n\t\t\t\tcolumnFilters.current = updater(columnFilters.current);\n\t\t\t} else {\n\t\t\t\tcolumnFilters.current = updater;\n\t\t\t}\n\t\t},\n\t\tonColumnVisibilityChange: (updater) => {\n\t\t\tif (typeof updater === \"function\") {\n\t\t\t\tcolumnVisibility.current = updater(columnVisibility.current);\n\t\t\t} else {\n\t\t\t\tcolumnVisibility.current = updater;\n\t\t\t}\n\n\t\t\t// Trigger column resize after visibility change\n\t\t\tif (enableResizing && tableBorderContainerRef) {\n\t\t\t\t// Use double requestAnimationFrame to ensure DOM has updated\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\tconst containerRect = tableBorderContainerRef?.getBoundingClientRect();\n\t\t\t\t\t\tif (!containerRect) return;\n\n\t\t\t\t\t\tconst visibleColumns = table.getAllColumns().filter((col) => col.getIsVisible());\n\t\t\t\t\t\tif (visibleColumns.length === 0) return;\n\n\t\t\t\t\t\t// Calculate total size of ONLY visible columns\n\t\t\t\t\t\tconst currentSizes = visibleColumns.map((col) => col.getSize());\n\t\t\t\t\t\tconst currentTotalSize = currentSizes.reduce((sum, size) => sum + size, 0);\n\t\t\t\t\t\tconst availableWidth = containerRect.width;\n\t\t\t\t\t\tconst spaceDifference = availableWidth - currentTotalSize;\n\n\t\t\t\t\t\t// Only resize if columns are narrower than container (no horizontal scroll needed)\n\t\t\t\t\t\t// If columns are wider, let them scroll horizontally\n\t\t\t\t\t\tif (spaceDifference > 10 && currentTotalSize > 0) {\n\t\t\t\t\t\t\t// Distribute extra space proportionally among visible columns\n\t\t\t\t\t\t\tconst newSizing: ColumnSizingState = { ...columnSizing.current };\n\n\t\t\t\t\t\t\tvisibleColumns.forEach((col, index) => {\n\t\t\t\t\t\t\t\tconst currentSize = currentSizes[index]!;\n\t\t\t\t\t\t\t\tconst proportion = currentSize / currentTotalSize;\n\t\t\t\t\t\t\t\tconst sizeAdjustment = spaceDifference * proportion;\n\t\t\t\t\t\t\t\tconst newSize = currentSize + sizeAdjustment;\n\t\t\t\t\t\t\t\t// Ensure we don't go below minSize\n\t\t\t\t\t\t\t\tconst minSize = col.columnDef.minSize ?? 100;\n\t\t\t\t\t\t\t\tnewSizing[col.id] = Math.max(minSize, newSize);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tcolumnSizing.current = newSizing;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonPaginationChange: (updater) => {\n\t\t\tif (typeof updater === \"function\") {\n\t\t\t\tpagination = updater(pagination);\n\t\t\t} else {\n\t\t\t\tpagination = updater;\n\t\t\t}\n\t\t},\n\t\tonColumnSizingChange: (updater) => {\n\t\t\tif (typeof updater === \"function\") {\n\t\t\t\tcolumnSizing.current = updater(columnSizing.current);\n\t\t\t} else {\n\t\t\t\tcolumnSizing.current = updater;\n\t\t\t}\n\t\t},\n\t\tonColumnSizingInfoChange: (updater) => {\n\t\t\tif (typeof updater === \"function\") {\n\t\t\t\tcolumnSizingInfo = updater(columnSizingInfo);\n\t\t\t} else {\n\t\t\t\tcolumnSizingInfo = updater;\n\t\t\t}\n\t\t},\n\t\tautoResetPageIndex: false,\n\t\tgetCoreRowModel: getCoreRowModel(),\n\t\tgetFilteredRowModel: getFilteredRowModel(),\n\t\tgetPaginationRowModel: enablePagination ? getPaginationRowModel() : undefined,\n\t\tgetSortedRowModel: getSortedRowModel(),\n\t\tgetFacetedRowModel: getFacetedRowModel(),\n\t\tgetFacetedUniqueValues: getFacetedUniqueValues(),\n\t\tgetExpandedRowModel: getExpandedRowModel(),\n\t\t// Performance optimizations\n\t\tenableColumnResizing: enableResizing,\n\t\tenableMultiSort: true,\n\t});\n\tlet columnSizeVars = $derived.by(() => {\n\t\tconst headers = untrack(() => table.getFlatHeaders());\n\t\tconst sizingInfo = columnSizingInfo;\n\t\tconst sizing = columnSizing.current;\n\t\tconst colSizes: { [key: string]: number } = {};\n\t\tfor (let i = 0; i < headers.length; i++) {\n\t\t\tconst header = headers[i]!;\n\t\t\tcolSizes[`--header-${header.id}-size`] = header.getSize();\n\t\t\tcolSizes[`--col-${header.column.id}-size`] = header.column.getSize();\n\t\t}\n\t\treturn Object.entries(colSizes)\n\t\t\t.map(([key, value]) => `${key}: ${value};`)\n\t\t\t.join(\" \");\n\t});\n\n\t//reset page when filters change\n\tlet previousFilterState = $state<string>(\"\");\n\t$effect(() => {\n\t\tconst currentFilterState = JSON.stringify({\n\t\t\tglobalFilter,\n\t\t\tcolumnFilters: columnFilters.current,\n\t\t});\n\t\tif (previousFilterState && previousFilterState !== currentFilterState) {\n\t\t\tpagination = { ...pagination, pageIndex: 0 };\n\t\t}\n\t\tpreviousFilterState = currentFilterState;\n\t});\n\n\t// Track visible columns to detect visibility changes\n\tconst visibleColumnIds = $derived.by(() => {\n\t\treturn table\n\t\t\t.getAllColumns()\n\t\t\t.filter((col) => col.getIsVisible())\n\t\t\t.map((col) => col.id)\n\t\t\t.sort()\n\t\t\t.join(\",\");\n\t});\n\n\t// Auto-resize columns when visibility changes\n\tlet previousVisibleColumnIds = $state<string>(\"\");\n\t$effect(() => {\n\t\tif (!enableResizing || !tableBorderContainerRef) return;\n\n\t\tconst currentVisibleIds = visibleColumnIds;\n\n\t\t// Only resize if visibility actually changed\n\t\tif (previousVisibleColumnIds && previousVisibleColumnIds !== currentVisibleIds) {\n\t\t\t// Use double requestAnimationFrame to ensure DOM has fully updated after visibility change\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tconst containerRect = tableBorderContainerRef?.getBoundingClientRect();\n\t\t\t\t\tif (!containerRect) return;\n\n\t\t\t\t\tconst visibleColumns = table.getAllColumns().filter((col) => col.getIsVisible());\n\t\t\t\t\tif (visibleColumns.length === 0) return;\n\n\t\t\t\t\t// Calculate total size of ONLY visible columns\n\t\t\t\t\tconst currentSizes = visibleColumns.map((col) => col.getSize());\n\t\t\t\t\tconst currentTotalSize = currentSizes.reduce((sum, size) => sum + size, 0);\n\t\t\t\t\tconst availableWidth = containerRect.width;\n\t\t\t\t\tconst spaceDifference = availableWidth - currentTotalSize;\n\n\t\t\t\t\t// Only resize if columns are narrower than container (no horizontal scroll needed)\n\t\t\t\t\t// If columns are wider, let them scroll horizontally\n\t\t\t\t\tif (spaceDifference > 10 && currentTotalSize > 0) {\n\t\t\t\t\t\t// Distribute extra space proportionally among visible columns\n\t\t\t\t\t\tconst newSizing: ColumnSizingState = { ...columnSizing.current };\n\n\t\t\t\t\t\tvisibleColumns.forEach((col, index) => {\n\t\t\t\t\t\t\tconst currentSize = currentSizes[index]!;\n\t\t\t\t\t\t\tconst proportion = currentSize / currentTotalSize;\n\t\t\t\t\t\t\tconst sizeAdjustment = spaceDifference * proportion;\n\t\t\t\t\t\t\tconst newSize = currentSize + sizeAdjustment;\n\t\t\t\t\t\t\t// Ensure we don't go below minSize\n\t\t\t\t\t\t\tconst minSize = col.columnDef.minSize ?? 100;\n\t\t\t\t\t\t\tnewSizing[col.id] = Math.max(minSize, newSize);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tcolumnSizing.current = newSizing;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tpreviousVisibleColumnIds = currentVisibleIds;\n\t});\n\n\t// Sort filtered rows by priority when global filter is active\n\t// Note: globalFilterFn only filters (returns boolean), it doesn't sort.\n\t// We need to sort the filtered results to show higher-priority matches first.\n\tconst rows = $derived.by(() => {\n\t\tconst filteredRows = table.getRowModel().rows;\n\n\t\t// If there's a global filter, sort by match priority\n\t\tif (globalFilter && typeof globalFilter === \"string\" && globalFilter.trim()) {\n\t\t\treturn [...filteredRows].sort((a, b) => {\n\t\t\t\tconst priorityA = prioritizedIncludesString(a, \"\", globalFilter);\n\t\t\t\tconst priorityB = prioritizedIncludesString(b, \"\", globalFilter);\n\t\t\t\t// Higher priority first (3 > 2 > 1)\n\t\t\t\treturn priorityB - priorityA;\n\t\t\t});\n\t\t}\n\n\t\treturn filteredRows;\n\t});\n\tconst headerGroups = $derived(table.getHeaderGroups());\n\n\t//progressive rendering: render rows in batches\n\tlet visibleRowsCount = $state(0);\n\tconst BATCH_SIZE = 3;\n\n\t$effect(() => {\n\t\tvisibleRowsCount = Math.min(BATCH_SIZE, rows.length);\n\t});\n\n\t$effect(() => {\n\t\tif (visibleRowsCount < rows.length) {\n\t\t\tconst timer = setTimeout(() => {\n\t\t\t\tvisibleRowsCount = Math.min(visibleRowsCount + BATCH_SIZE, rows.length);\n\t\t\t}, 0);\n\t\t\treturn () => clearTimeout(timer);\n\t\t}\n\t});\n\n\tconst visibleRows = $derived(rows.slice(0, visibleRowsCount));\n\n\t// Track if we're on mobile (disable sticky on mobile)\n\tlet isMobile = $state(false);\n\n\t$effect(() => {\n\t\tif (typeof window === \"undefined\") return;\n\n\t\tconst checkMobile = () => {\n\t\t\tisMobile = window.innerWidth < 768; // md breakpoint\n\t\t};\n\n\t\tcheckMobile();\n\t\twindow.addEventListener(\"resize\", checkMobile);\n\t\treturn () => window.removeEventListener(\"resize\", checkMobile);\n\t});\n\n\t// Calculate sticky column positions and offsets\n\tconst stickyColumnInfo = $derived.by(() => {\n\t\tconst headers = untrack(() => table.getFlatHeaders());\n\t\tconst visibleHeaders = headers.filter((header) => !header.column.columnDef.meta?.hidden);\n\n\t\tconst stickyInfo: Map<string, { position: \"left\" | \"right\"; offset: number; zIndex: number }> =\n\t\t\tnew Map();\n\n\t\tif (isMobile) {\n\t\t\treturn stickyInfo; // No sticky on mobile\n\t\t}\n\n\t\t// Calculate left-sticky columns\n\t\tlet leftOffset = 0;\n\t\tlet leftZIndex = 10;\n\t\tfor (let i = 0; i < visibleHeaders.length; i++) {\n\t\t\tconst header = visibleHeaders[i]!;\n\t\t\tconst sticky = header.column.columnDef.meta?.sticky;\n\t\t\tif (sticky === \"left\") {\n\t\t\t\tstickyInfo.set(header.id, {\n\t\t\t\t\tposition: \"left\",\n\t\t\t\t\toffset: leftOffset,\n\t\t\t\t\tzIndex: leftZIndex++,\n\t\t\t\t});\n\t\t\t\tleftOffset += header.getSize();\n\t\t\t}\n\t\t}\n\n\t\t// Calculate right-sticky columns (from right to left)\n\t\tlet rightOffset = 0;\n\t\tlet rightZIndex = 10;\n\t\tfor (let i = visibleHeaders.length - 1; i >= 0; i--) {\n\t\t\tconst header = visibleHeaders[i]!;\n\t\t\tconst sticky = header.column.columnDef.meta?.sticky;\n\t\t\tif (sticky === \"right\") {\n\t\t\t\tstickyInfo.set(header.id, {\n\t\t\t\t\tposition: \"right\",\n\t\t\t\t\toffset: rightOffset,\n\t\t\t\t\tzIndex: rightZIndex++,\n\t\t\t\t});\n\t\t\t\trightOffset += header.getSize();\n\t\t\t}\n\t\t}\n\n\t\treturn stickyInfo;\n\t});\n\n\t// Helper function to get sticky styles for a column\n\tfunction getStickyStyles(columnId: string, isHeader: boolean = false): string {\n\t\tif (isMobile) return \"\";\n\n\t\tconst info = stickyColumnInfo.get(columnId);\n\t\tif (!info) return \"\";\n\n\t\tconst { position, offset, zIndex } = info;\n\t\tconst bgColor = isHeader ? \"rgb(243, 244, 246)\" : \"white\"; // Match header bg-gray-100 or white for cells\n\t\treturn `position: sticky; ${position}: ${offset}px; z-index: ${zIndex}; background-color: ${bgColor};`;\n\t}\n\n\tonMount(() => {\n\t\t// if enableResizing, resize visible columns to fit the container width\n\t\tif (enableResizing && table.getAllColumns().length > 0) {\n\t\t\t// Use requestAnimationFrame to ensure DOM is ready\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tconst containerRect = tableBorderContainerRef?.getBoundingClientRect();\n\t\t\t\tif (!containerRect) return;\n\n\t\t\t\tconst visibleColumns = table.getAllColumns().filter((col) => col.getIsVisible());\n\t\t\t\tif (visibleColumns.length === 0) return;\n\n\t\t\t\t// Calculate total size of ONLY visible columns\n\t\t\t\tconst currentSizes = visibleColumns.map((col) => col.getSize());\n\t\t\t\tconst currentTotalSize = currentSizes.reduce((sum, size) => sum + size, 0);\n\t\t\t\tconst availableWidth = containerRect.width;\n\t\t\t\tconst spaceDifference = availableWidth - currentTotalSize;\n\n\t\t\t\t// Only resize if columns are narrower than container (no horizontal scroll needed)\n\t\t\t\t// If columns are wider, let them scroll horizontally\n\t\t\t\tif (spaceDifference > 10 && currentTotalSize > 0) {\n\t\t\t\t\t// Distribute extra space proportionally among visible columns\n\t\t\t\t\tconst newSizing: ColumnSizingState = { ...columnSizing.current };\n\n\t\t\t\t\tvisibleColumns.forEach((col, index) => {\n\t\t\t\t\t\tconst currentSize = currentSizes[index]!;\n\t\t\t\t\t\tconst proportion = currentSize / currentTotalSize;\n\t\t\t\t\t\tconst sizeAdjustment = spaceDifference * proportion;\n\t\t\t\t\t\tconst newSize = currentSize + sizeAdjustment;\n\t\t\t\t\t\t// Ensure we don't go below minSize\n\t\t\t\t\t\tconst minSize = col.columnDef.minSize ?? 100;\n\t\t\t\t\t\tnewSizing[col.id] = Math.max(minSize, newSize);\n\t\t\t\t\t});\n\n\t\t\t\t\tcolumnSizing.current = newSizing;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n</script>\n\n{#snippet Pagination({ table }: { table: TableType<TData> })}\n\t<div class=\"flex flex-col gap-3 px-2 sm:flex-row sm:items-center sm:justify-between\">\n\t\t<!-- Mobile: Left side with selection text and page info stacked -->\n\t\t<div class=\"flex flex-col gap-1 sm:flex-1 sm:flex-row\">\n\t\t\t<div class=\"text-muted-foreground text-xs sm:text-sm\">\n\t\t\t\t{#if table.options.enableRowSelection}\n\t\t\t\t\t{table.getFilteredSelectedRowModel().rows.length} von\n\t\t\t\t\t{table.getFilteredRowModel().rows.length} Zeile(n) ausgewählt\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t<!-- Mobile: Page info below selection text -->\n\t\t\t<div class=\"text-foreground text-sm font-medium sm:hidden\">\n\t\t\t\tSeite {table.getState().pagination.pageIndex + 1} von {table.getPageCount()}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:space-x-4 lg:space-x-6\">\n\t\t\t<!-- Mobile: Seiten popover on the right -->\n\t\t\t<div class=\"flex items-center justify-between gap-2 sm:hidden\">\n\t\t\t\t<DataTablePaginationMenu {table} includePageSizeSelector={true} align=\"end\" />\n\t\t\t</div>\n\n\t\t\t<!-- Tablet: Seite X von Y on left, Seiten popover on right with page size selector inside -->\n\t\t\t<div class=\"hidden items-center justify-between gap-2 sm:flex lg:hidden\">\n\t\t\t\t<div class=\"text-sm font-medium\">\n\t\t\t\t\tSeite {table.getState().pagination.pageIndex + 1} von {table.getPageCount()}\n\t\t\t\t</div>\n\t\t\t\t<DataTablePaginationMenu {table} includePageSizeSelector={true} align=\"end\" />\n\t\t\t</div>\n\n\t\t\t<!-- Desktop: Full button layout -->\n\t\t\t<div class=\"hidden items-center space-x-2 lg:flex\">\n\t\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t\t<p class=\"text-sm font-medium\">Zeilen pro Seite</p>\n\t\t\t\t\t<Select.Root\n\t\t\t\t\t\tallowDeselect={false}\n\t\t\t\t\t\ttype=\"single\"\n\t\t\t\t\t\tvalue={`${table.getState().pagination.pageSize}`}\n\t\t\t\t\t\tonValueChange={(value) => {\n\t\t\t\t\t\t\ttable.setPageSize(Number(value));\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Select.Trigger class=\"h-8 w-[70px]\">\n\t\t\t\t\t\t\t{String(table.getState().pagination.pageSize)}\n\t\t\t\t\t\t</Select.Trigger>\n\t\t\t\t\t\t<Select.Content side=\"top\">\n\t\t\t\t\t\t\t{#each [10, 20, 30, 40, 50] as pageSize (pageSize)}\n\t\t\t\t\t\t\t\t<Select.Item value={`${pageSize}`}>\n\t\t\t\t\t\t\t\t\t{pageSize}\n\t\t\t\t\t\t\t\t</Select.Item>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</Select.Content>\n\t\t\t\t\t</Select.Root>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"flex w-[100px] items-center justify-center text-sm font-medium whitespace-nowrap\"\n\t\t\t\t>\n\t\t\t\t\tSeite {table.getState().pagination.pageIndex + 1} von\n\t\t\t\t\t{table.getPageCount()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\tclass=\"size-8 p-0\"\n\t\t\t\t\t\tonclick={() => table.setPageIndex(0)}\n\t\t\t\t\t\tdisabled={!table.getCanPreviousPage()}\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"sr-only\">Go to first page</span>\n\t\t\t\t\t\t<ChevronsLeftIcon />\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\tclass=\"size-8 p-0\"\n\t\t\t\t\t\tonclick={() => table.previousPage()}\n\t\t\t\t\t\tdisabled={!table.getCanPreviousPage()}\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"sr-only\">Go to previous page</span>\n\t\t\t\t\t\t<ChevronLeftIcon />\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\tclass=\"size-8 p-0\"\n\t\t\t\t\t\tonclick={() => table.nextPage()}\n\t\t\t\t\t\tdisabled={!table.getCanNextPage()}\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"sr-only\">Go to next page</span>\n\t\t\t\t\t\t<ChevronRightIcon />\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\tclass=\"size-8 p-0\"\n\t\t\t\t\t\tonclick={() => table.setPageIndex(table.getPageCount() - 1)}\n\t\t\t\t\t\tdisabled={!table.getCanNextPage()}\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"sr-only\">Go to last page</span>\n\t\t\t\t\t\t<ChevronsRightIcon />\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/snippet}\n\n{#snippet ColumnHeader({\n\tcolumn,\n\ttitle,\n\tclass: className,\n\t...restProps\n}: { column: Column<TData>; title: string } & HTMLAttributes<HTMLDivElement>)}\n\t{@const canSort = column.columnDef.enableSorting && column?.getCanSort()}\n\t{@const canFilter = column.columnDef.enableColumnFilter && column.getCanFilter()}\n\t{@const currentSort = column.getIsSorted()}\n\t{#if !canSort && !canFilter}\n\t\t<div class={cn(\"truncate\", className)} {...restProps}>\n\t\t\t<span class=\"truncate\">{title}</span>\n\t\t</div>\n\t{:else}\n\t\t<div\n\t\t\tclass={cn(\"relative left-[-4px] flex min-w-0 items-center gap-1\", className)}\n\t\t\t{...restProps}\n\t\t>\n\t\t\t{#if canSort}\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass={cn(\n\t\t\t\t\t\tbuttonVariants({ size: \"sm\", variant: \"ghost\" }),\n\t\t\t\t\t\t\"h-7 max-w-full min-w-0 rounded-md px-2 text-xs font-[600] tracking-wider text-[rgba(0,0,0,0.6)] uppercase hover:bg-[#00000010] has-[>svg]:px-2\",\n\t\t\t\t\t\tcurrentSort ? \"text-primary bg-[rgba(0,0,0,0.05)]\" : \"\"\n\t\t\t\t\t)}\n\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\tconst currentSorting = table.getState().sorting;\n\t\t\t\t\t\tconst columnId = column.id;\n\n\t\t\t\t\t\t// Find if this column is already sorted\n\t\t\t\t\t\tconst existingSortIndex = currentSorting.findIndex((s) => s.id === columnId);\n\n\t\t\t\t\t\tlet newSorting: SortingState;\n\n\t\t\t\t\t\tif (existingSortIndex === -1) {\n\t\t\t\t\t\t\t// Column not sorted: add it as ASC (last priority)\n\t\t\t\t\t\t\tnewSorting = [...currentSorting, { id: columnId, desc: false }];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst existingSort = currentSorting[existingSortIndex]!;\n\t\t\t\t\t\t\tif (existingSort.desc === false) {\n\t\t\t\t\t\t\t\t// Currently ASC: change to DESC\n\t\t\t\t\t\t\t\tnewSorting = [...currentSorting];\n\t\t\t\t\t\t\t\tnewSorting[existingSortIndex] = { id: columnId, desc: true };\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Currently DESC: remove from sorting\n\t\t\t\t\t\t\t\tnewSorting = currentSorting.filter((s) => s.id !== columnId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Update sorting (this will trigger onSortingChange and persist to localStorage)\n\t\t\t\t\t\ttable.setSorting(newSorting);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t{#if currentSort === \"desc\"}\n\t\t\t\t\t\t<ArrowDownIcon class=\"shrink-0\" />\n\t\t\t\t\t{:else if currentSort === \"asc\"}\n\t\t\t\t\t\t<ArrowUpIcon class=\"shrink-0\" />\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<ChevronsUpDownIcon class=\"shrink-0\" />\n\t\t\t\t\t{/if}\n\t\t\t\t\t<span class=\"truncate\">{title}</span>\n\t\t\t\t</button>\n\t\t\t{:else}\n\t\t\t\t<span\n\t\t\t\t\tclass=\"truncate px-2 text-xs font-[600] tracking-wider text-[rgba(0,0,0,0.6)] uppercase\"\n\t\t\t\t\t>{title}</span\n\t\t\t\t>\n\t\t\t{/if}\n\t\t\t{#if canFilter}\n\t\t\t\t<DataTableColumnFilter {table} {column} />\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n{/snippet}\n\n<div\n\tclass={cn(\"space-y-4\", embeddedInParent ? \"flex h-full flex-col\" : \"\")}\n\tbind:this={tableContainerRef}\n>\n\t<DataTableToolbar {table} {getColumnIconSnippet} insertButton={insertButtonSnippet}>\n\t\t{#snippet customElementsFirst(table)}\n\t\t\t{#if customElementsFirstSnippet}\n\t\t\t\t{@render customElementsFirstSnippet?.(table)}\n\t\t\t{/if}\n\t\t{/snippet}\n\t\t{#snippet customElementsMiddle(table)}\n\t\t\t{#if customElementsMiddleSnippet}\n\t\t\t\t{@render customElementsMiddleSnippet?.(table)}\n\t\t\t{/if}\n\t\t{/snippet}\n\t\t{#snippet customElementsLast(table)}\n\t\t\t{#if enableSearch}\n\t\t\t\t<!-- Desktop: Full search input -->\n\t\t\t\t<div class=\"hidden w-full max-w-sm sm:block\">\n\t\t\t\t\t<Input\n\t\t\t\t\t\tplaceholder=\"Suche...\"\n\t\t\t\t\t\toninput={(e) => table.setGlobalFilter(e.currentTarget.value)}\n\t\t\t\t\t\tonchange={(e) => {\n\t\t\t\t\t\t\ttable.setGlobalFilter(e.currentTarget.value);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclass=\"h-[32px] text-sm\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<!-- Mobile: Search button with popover -->\n\t\t\t\t<Popover.Root bind:open={searchPopoverOpen}>\n\t\t\t\t\t<Popover.Trigger class=\"md:hidden\">\n\t\t\t\t\t\t{#snippet child({ props })}\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tclass=\"h-8 {globalFilter\n\t\t\t\t\t\t\t\t\t? 'text-primary border border-[rgba(0,0,0,0.05)] bg-[rgba(0,0,0,0.07)]'\n\t\t\t\t\t\t\t\t\t: ''} sm:hidden\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<SearchIcon class=\"size-4 {globalFilter ? 'fill-current' : ''}\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t{/snippet}\n\t\t\t\t\t</Popover.Trigger>\n\t\t\t\t\t<Popover.Content class=\"w-[300px] p-4\" align=\"end\">\n\t\t\t\t\t\t<div class=\"space-y-2\">\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tplaceholder=\"Suche...\"\n\t\t\t\t\t\t\t\tbind:value={mobileSearchValue}\n\t\t\t\t\t\t\t\toninput={(e) => {\n\t\t\t\t\t\t\t\t\tmobileSearchValue = e.currentTarget.value;\n\t\t\t\t\t\t\t\t\ttable.setGlobalFilter(e.currentTarget.value);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonchange={(e) => {\n\t\t\t\t\t\t\t\t\tmobileSearchValue = e.currentTarget.value;\n\t\t\t\t\t\t\t\t\ttable.setGlobalFilter(e.currentTarget.value);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tclass=\"h-[32px] text-sm\"\n\t\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Popover.Content>\n\t\t\t\t</Popover.Root>\n\t\t\t{/if}\n\t\t{/snippet}\n\t</DataTableToolbar>\n\n\t<div\n\t\tclass={cn(\n\t\t\t\"overflow-hidden rounded-md border\",\n\t\t\tembeddedInParent ? \"relative flex-1 overflow-hidden\" : \"\"\n\t\t)}\n\t\tbind:this={tableBorderContainerRef}\n\t>\n\t\t<div class={cn(\"overflow-x-auto\", embeddedInParent ? \"absolute inset-0 overflow-y-auto\" : \"\")}>\n\t\t\t<Table.Root\n\t\t\t\tclass={cn(enableResizing ? \"table-fixed bg-white\" : \"\")}\n\t\t\t\tstyle={enableResizing ? columnSizeVars + `width: ${table.getCenterTotalSize()}px;` : \"\"}\n\t\t\t>\n\t\t\t\t<Table.Header class={cn(\"bg-gray-100\", embeddedInParent ? \"sticky top-0 z-10\" : \"\")}>\n\t\t\t\t\t{#each headerGroups as headerGroup (headerGroup.id)}\n\t\t\t\t\t\t{@const visibleHeaders = headerGroup.headers.filter(\n\t\t\t\t\t\t\t(header) => !header.column.columnDef.meta?.hidden\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<Table.Row>\n\t\t\t\t\t\t\t{#each visibleHeaders as header (header.id)}\n\t\t\t\t\t\t\t\t<Table.Head\n\t\t\t\t\t\t\t\t\tcolspan={header.colSpan}\n\t\t\t\t\t\t\t\t\tclass={cn(\n\t\t\t\t\t\t\t\t\t\t\"text-xs font-[600] tracking-wider text-[rgba(0,0,0,0.6)] uppercase\",\n\t\t\t\t\t\t\t\t\t\tenableResizing ? \"relative border-l first:border-l-0\" : \"\"\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tstyle={`${\n\t\t\t\t\t\t\t\t\t\tenableResizing ? ` width: calc(var(--header-${header.id}-size) * 1px);` : \"\"\n\t\t\t\t\t\t\t\t\t}${getStickyStyles(header.id, true)}`}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{#if !header.isPlaceholder}\n\t\t\t\t\t\t\t\t\t\t{#if header.column.columnDef.header instanceof Function && header.column.id === \"select\"}\n\t\t\t\t\t\t\t\t\t\t\t<FlexRender\n\t\t\t\t\t\t\t\t\t\t\t\tcontent={header.column.columnDef.header}\n\t\t\t\t\t\t\t\t\t\t\t\tcontext={header.getContext()}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<FlexRender\n\t\t\t\t\t\t\t\t\t\t\t\tcontent={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\trenderSnippet(ColumnHeader, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcolumn: header.column,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: getColumnHeaderValue(header.column, table),\n\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\tcontext={header.getContext()}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t{#if enableResizing}\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tondblclick={() => header.column.resetSize()}\n\t\t\t\t\t\t\t\t\t\t\t\tonmousedown={header.getResizeHandler()}\n\t\t\t\t\t\t\t\t\t\t\t\tontouchstart={header.getResizeHandler()}\n\t\t\t\t\t\t\t\t\t\t\t\tclass={`resizer ${\n\t\t\t\t\t\t\t\t\t\t\t\t\ttable.options.columnResizeDirection\n\t\t\t\t\t\t\t\t\t\t\t\t} ${header.column.getIsResizing() ? \"isResizing\" : \"\"}`}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"sr-only\">Resize column</span>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</Table.Head>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</Table.Row>\n\t\t\t\t\t{/each}\n\t\t\t\t</Table.Header>\n\t\t\t\t<Table.Body>\n\t\t\t\t\t{#each visibleRows as row (row.id)}\n\t\t\t\t\t\t{@const visibleCells = row\n\t\t\t\t\t\t\t.getVisibleCells()\n\t\t\t\t\t\t\t.filter((cell) => !cell.column.columnDef.meta?.hidden)}\n\t\t\t\t\t\t<Table.Row\n\t\t\t\t\t\t\tclass={cn(onRowClick ? \"cursor-pointer\" : \"\", rowHighlight?.(row) || \"\")}\n\t\t\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\t\t\tonRowClick?.(row);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tdata-state={row.getIsSelected() && \"selected\"}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#each visibleCells as cell (cell.id)}\n\t\t\t\t\t\t\t\t<Table.Cell\n\t\t\t\t\t\t\t\t\tclass={cn(\"min-w-0 overflow-hidden\", cellClasses)}\n\t\t\t\t\t\t\t\t\tstyle={`${\n\t\t\t\t\t\t\t\t\t\tenableResizing ? ` width: calc(var(--col-${cell.column.id}-size) * 1px);` : \"\"\n\t\t\t\t\t\t\t\t\t}${getStickyStyles(cell.column.id, false)}`}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\"block max-w-full min-w-0 truncate\">\n\t\t\t\t\t\t\t\t\t\t<FlexRender content={cell.column.columnDef.cell} context={cell.getContext()} />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</Table.Row>\n\n\t\t\t\t\t\t{#if row.getIsExpanded()}\n\t\t\t\t\t\t\t<Table.Row>\n\t\t\t\t\t\t\t\t<Table.Cell colspan={row.getAllCells().length}>\n\t\t\t\t\t\t\t\t\t{@render expandedRow?.(row)}\n\t\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t\t</Table.Row>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<Table.Row>\n\t\t\t\t\t\t\t<Table.Cell colspan={columns.length} class=\"h-24 text-center\">\n\t\t\t\t\t\t\t\tKeine Daten gefunden\n\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t</Table.Row>\n\t\t\t\t\t{/each}\n\n\t\t\t\t\t{#if visibleRowsCount < rows.length}\n\t\t\t\t\t\t{#each Array(rows.length - visibleRowsCount) as _, i (i + visibleRowsCount)}\n\t\t\t\t\t\t\t<Table.Row>\n\t\t\t\t\t\t\t\t{#each headerGroups[0]?.headers.filter((h) => !h.column.columnDef.meta?.hidden) || [] as header}\n\t\t\t\t\t\t\t\t\t<Table.Cell\n\t\t\t\t\t\t\t\t\t\tclass={cellClasses}\n\t\t\t\t\t\t\t\t\t\tstyle={`${\n\t\t\t\t\t\t\t\t\t\t\tenableResizing ? ` width: calc(var(--col-${header.id}-size) * 1px);` : \"\"\n\t\t\t\t\t\t\t\t\t\t}${getStickyStyles(header.id, false)}`}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div class=\"bg-muted h-4 w-3/4 rounded\"></div>\n\t\t\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</Table.Row>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t{/if}\n\t\t\t\t</Table.Body>\n\t\t\t</Table.Root>\n\t\t</div>\n\t</div>\n\n\t{#if enablePagination}\n\t\t{@render Pagination({ table })}\n\t{/if}\n</div>\n\n<style>\n\t.resizer {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\theight: 100%;\n\t\twidth: 2px;\n\t\tbackground: rgba(0, 0, 0, 0.2);\n\t\tcursor: col-resize;\n\t\tuser-select: none;\n\t\ttouch-action: none;\n\t}\n\n\t.resizer.ltr {\n\t\tright: 0;\n\t}\n\n\t.resizer.rtl {\n\t\tleft: 0;\n\t}\n\n\t.resizer.isResizing {\n\t\tbackground: blue;\n\t\topacity: 1;\n\t}\n\n\t.resizer {\n\t\topacity: 0;\n\t}\n\n\t:global(*:hover > .resizer) {\n\t\topacity: 1;\n\t}\n\n\t:global([data-slot=\"table-cell\"] > div.truncate > *) {\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t\tmin-width: 0;\n\t\tmax-width: 100%;\n\t}\n</style>\n",
			"type": "registry:component",
			"target": "blocks/data-table/data-table.svelte"
		},
		{
			"content": "<script lang=\"ts\" generics=\"TData\">\n\timport type { Table } from \"@tanstack/table-core\";\n\timport { DataTableViewOptions } from \".\";\n\timport DataTableFilterPopover from \"./data-table-filter-popover.svelte\";\n\timport DataTableSortPopover from \"./data-table-sort-popover.svelte\";\n\timport type { Snippet } from \"svelte\";\n\n\tlet {\n\t\ttable,\n\t\tcustomElementsFirst,\n\t\tcustomElementsLast,\n\t\tcustomElementsMiddle,\n\t\tgetColumnIconSnippet,\n\t\tinsertButton,\n\t}: {\n\t\ttable: Table<TData>;\n\t\tcustomElementsFirst?: Snippet<[Table<TData>]>;\n\t\tcustomElementsLast?: Snippet<[Table<TData>]>;\n\t\tcustomElementsMiddle?: Snippet<[Table<TData>]>;\n\t\tgetColumnIconSnippet?: (column: any) => Snippet<[{ column: any }]> | undefined;\n\t\tinsertButton?: Snippet<[Table<TData>]>;\n\t} = $props();\n\n\tconst filterableCols = $derived(\n\t\ttable\n\t\t\t.getHeaderGroups()[0]\n\t\t\t.headers.filter((h) => h.column.columnDef.enableColumnFilter && h.column.getCanFilter())\n\t\t\t.map((h) => h.column)\n\t);\n\n\tconst sortableCols = $derived(\n\t\ttable\n\t\t\t.getHeaderGroups()[0]\n\t\t\t.headers.filter((h) => h.column.columnDef.enableSorting && h.column.getCanSort())\n\t\t\t.map((h) => h.column)\n\t);\n</script>\n\n<div class=\"flex items-center justify-between\">\n\t<div class=\"flex flex-1 items-center space-x-2\">\n\t\t{#if filterableCols.length > 0}\n\t\t\t<DataTableFilterPopover {table} {filterableCols} />\n\t\t{/if}\n\n\t\t{#if sortableCols.length > 0}\n\t\t\t<DataTableSortPopover {table} {sortableCols} />\n\t\t{/if}\n\n\t\t{#if customElementsMiddle}\n\t\t\t{@render customElementsMiddle?.(table)}\n\t\t{/if}\n\t</div>\n\t<div class=\"ml-2 flex flex-1 items-center justify-end gap-2\">\n\t\t{@render customElementsLast?.(table)}\n\n\t\t{#if table\n\t\t\t.getAllColumns()\n\t\t\t.filter((col) => col.columnDef.enableHiding && col.getCanHide()).length > 0}\n\t\t\t<DataTableViewOptions {table} />\n\t\t{/if}\n\n\t\t{#if insertButton}\n\t\t\t{@render insertButton(table)}\n\t\t{/if}\n\t</div>\n</div>\n",
			"type": "registry:component",
			"target": "blocks/data-table/data-table-toolbar.svelte"
		},
		{
			"content": "<script lang=\"ts\" generics=\"TData\">\n\timport Settings2Icon from \"@lucide/svelte/icons/settings-2\";\n\timport XIcon from \"@lucide/svelte/icons/x\";\n\timport type { Table } from \"@tanstack/table-core\";\n\timport { Button, buttonVariants } from \"$lib/components/ui/button\";\n\timport * as Popover from \"$lib/components/ui/popover\";\n\timport Checkbox from \"$lib/components/ui/checkbox/checkbox.svelte\";\n\timport { getColumnHeaderValue } from \"./utils.js\";\n\timport { cn } from \"$UTILS$.js\";\n\n\tlet { table }: { table: Table<TData> } = $props();\n\n\tconst hideableColumns = $derived(\n\t\ttable.getAllColumns().filter((col) => col.columnDef.enableHiding && col.getCanHide())\n\t);\n\n\t// Visibility differs from defaults if any hideable column is currently hidden\n\tconst hasVisibilityChanges = $derived.by(() => {\n\t\treturn hideableColumns.some((col) => !col.getIsVisible());\n\t});\n</script>\n\n<Popover.Root>\n\t<Popover.Trigger>\n\t\t{#snippet child({ props })}\n\t\t\t<Button\n\t\t\t\t{...props}\n\t\t\t\tvariant=\"outline\"\n\t\t\t\tsize=\"sm\"\n\t\t\t\tclass=\"h-8 border {hasVisibilityChanges\n\t\t\t\t\t? 'text-primary border border-[rgba(0,0,0,0.05)] bg-[rgba(0,0,0,0.07)]'\n\t\t\t\t\t: ''}\"\n\t\t\t>\n\t\t\t\t<Settings2Icon class=\"size-4 {hasVisibilityChanges ? 'fill-current' : ''}\" />\n\t\t\t\t<span class=\"hidden md:inline\">Darstellung</span>\n\t\t\t</Button>\n\t\t{/snippet}\n\t</Popover.Trigger>\n\t<Popover.Content class=\"w-56 p-0\" align=\"end\">\n\t\t<div class=\"relative p-4\">\n\t\t\t<Popover.Close\n\t\t\t\tclass={cn(\n\t\t\t\t\tbuttonVariants({ variant: \"ghost\", size: \"sm\" }),\n\t\t\t\t\t\"absolute top-2 right-2 size-6 p-0\"\n\t\t\t\t)}\n\t\t\t>\n\t\t\t\t<XIcon class=\"size-4\" />\n\t\t\t</Popover.Close>\n\t\t\t<div class=\"space-y-4\">\n\t\t\t\t<div class=\"space-y-2\">\n\t\t\t\t\t<h4 class=\"text-sm font-medium\">Eingeblendete Spalten</h4>\n\t\t\t\t\t<div class=\"bg-border h-px\" />\n\t\t\t\t\t<div class=\"mt-3 space-y-2\">\n\t\t\t\t\t\t{#each table\n\t\t\t\t\t\t\t.getAllColumns()\n\t\t\t\t\t\t\t.filter((col) => col.columnDef.enableHiding && col.getCanHide()) as column (column)}\n\t\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<Checkbox\n\t\t\t\t\t\t\t\t\tchecked={column.getIsVisible()}\n\t\t\t\t\t\t\t\t\tonCheckedChange={(checked) => column.toggleVisibility(!!checked)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<label\n\t\t\t\t\t\t\t\t\tclass=\"flex-1 cursor-pointer text-sm leading-none font-normal peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n\t\t\t\t\t\t\t\t\tonclick={() => column.toggleVisibility(!column.getIsVisible())}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{getColumnHeaderValue(column, table)}\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</Popover.Content>\n</Popover.Root>\n",
			"type": "registry:component",
			"target": "blocks/data-table/data-table-view-options.svelte"
		},
		{
			"content": "<script lang=\"ts\" generics=\"TData\">\n\timport FilterIcon from \"@lucide/svelte/icons/filter\";\n\timport PlusIcon from \"@lucide/svelte/icons/plus\";\n\timport XIcon from \"@lucide/svelte/icons/x\";\n\timport CheckIcon from \"@lucide/svelte/icons/check\";\n\timport type { Column, Table } from \"@tanstack/table-core\";\n\timport * as Command from \"$lib/components/ui/command\";\n\timport * as Popover from \"$lib/components/ui/popover\";\n\timport * as Select from \"$lib/components/ui/select\";\n\timport { Button } from \"$lib/components/ui/button\";\n\timport { Input } from \"$lib/components/ui/input\";\n\timport { cn } from \"$UTILS$.js\";\n\timport { getColumnHeaderValue } from \"./utils.js\";\n\timport {\n\t\ttype FilterOperator,\n\t\ttype FilterRule,\n\t\tgetOperatorsForColumn,\n\t\tisDateColumn,\n\t\tDATE_PARTS,\n\t\tMONTHS,\n\t} from \"./filter-operators.js\";\n\n\tlet {\n\t\ttable,\n\t\tfilterableCols,\n\t}: {\n\t\ttable: Table<TData>;\n\t\tfilterableCols: Column<TData, unknown>[];\n\t} = $props();\n\n\t// Draft filters that are edited locally before applying\n\tlet draftFilters = $state<FilterRule[]>([]);\n\tlet popoverOpen = $state(false);\n\tlet valuePopoverOpen = $state<Record<string, boolean>>({});\n\n\t// Count of applied filters\n\tconst appliedFilterCount = $derived(table.getState().columnFilters.length);\n\n\t// Check if draft filters differ from applied filters\n\tconst hasChanges = $derived.by(() => {\n\t\tconst appliedFilters = table.getState().columnFilters;\n\n\t\t// Filter out incomplete rules from draft\n\t\tconst validDraftFilters = draftFilters.filter((f) => {\n\t\t\tif (f.operator === \"is_null\" || f.operator === \"is_not_null\") {\n\t\t\t\t// These operators don't need a value\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (f.operator === \"in\") {\n\t\t\t\treturn Array.isArray(f.value) && f.value.length > 0;\n\t\t\t}\n\t\t\tif (f.operator === \"between\") {\n\t\t\t\treturn f.value !== null && f.value !== \"\" && f.value2 !== null && f.value2 !== \"\";\n\t\t\t}\n\t\t\tif (f.operator === \"~~*\" && isDateFilter(f)) {\n\t\t\t\t// For \"enthält\" on dates, need datePart and datePartValue\n\t\t\t\treturn (\n\t\t\t\t\tf.datePart !== null &&\n\t\t\t\t\tf.datePart !== undefined &&\n\t\t\t\t\tf.datePartValue !== null &&\n\t\t\t\t\tf.datePartValue !== \"\"\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn f.value !== null && f.value !== \"\";\n\t\t});\n\n\t\t// If counts differ, there are changes\n\t\tif (validDraftFilters.length !== appliedFilters.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Compare each filter\n\t\tconst appliedFiltersMap = new Map(\n\t\t\tappliedFilters.map((cf) => {\n\t\t\t\tconst filterValue = cf.value as\n\t\t\t\t\t| { operator: FilterOperator; value: string | string[] | null; value2?: string | null }\n\t\t\t\t\t| string[];\n\t\t\t\tif (Array.isArray(filterValue)) {\n\t\t\t\t\treturn [cf.id, { operator: \"in\" as FilterOperator, value: filterValue }];\n\t\t\t\t}\n\t\t\t\treturn [cf.id, filterValue];\n\t\t\t})\n\t\t);\n\n\t\tfor (const draftFilter of validDraftFilters) {\n\t\t\tconst appliedFilter = appliedFiltersMap.get(draftFilter.columnId);\n\t\t\tif (!appliedFilter) return true;\n\n\t\t\tif (appliedFilter.operator !== draftFilter.operator) return true;\n\n\t\t\t// Operators that don't require values - just check operator match\n\t\t\tif (draftFilter.operator === \"is_null\" || draftFilter.operator === \"is_not_null\") {\n\t\t\t\t// No value comparison needed for these operators\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Compare values\n\t\t\tif (Array.isArray(draftFilter.value) && Array.isArray(appliedFilter.value)) {\n\t\t\t\tconst draftSet = new Set(draftFilter.value);\n\t\t\t\tconst appliedSet = new Set(appliedFilter.value);\n\t\t\t\tif (draftSet.size !== appliedSet.size) return true;\n\t\t\t\tfor (const val of draftSet) {\n\t\t\t\t\tif (!appliedSet.has(val)) return true;\n\t\t\t\t}\n\t\t\t} else if (draftFilter.value !== appliedFilter.value) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Compare value2 for between operator\n\t\t\tif (draftFilter.operator === \"between\" && draftFilter.value2 !== appliedFilter.value2) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Compare datePart and datePartValue for \"enthält\" on dates\n\t\t\tif (draftFilter.operator === \"~~*\" && isDateFilter(draftFilter)) {\n\t\t\t\tconst appliedValue = appliedFilter.value as string;\n\t\t\t\tif (typeof appliedValue === \"string\" && appliedValue.includes(\":\")) {\n\t\t\t\t\tconst [appliedDatePart, appliedDatePartValue] = appliedValue.split(\":\");\n\t\t\t\t\tif (\n\t\t\t\t\t\tdraftFilter.datePart !== appliedDatePart ||\n\t\t\t\t\t\tdraftFilter.datePartValue !== appliedDatePartValue\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn true; // Format mismatch\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t});\n\n\t// Ensure popover state exists for all filters\n\t$effect(() => {\n\t\tfor (const filter of draftFilters) {\n\t\t\tif (!(filter.id in valuePopoverOpen)) {\n\t\t\t\tvaluePopoverOpen[filter.id] = false;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Initialize draft filters from table state when popover opens\n\tfunction syncFromTable() {\n\t\tconst columnFilters = table.getState().columnFilters;\n\t\tdraftFilters = columnFilters.map((cf) => {\n\t\t\tconst filterValue = cf.value as\n\t\t\t\t| { operator: FilterOperator; value: string | string[] | null; value2?: string | null }\n\t\t\t\t| string[];\n\t\t\tconst filterId = crypto.randomUUID();\n\n\t\t\t// Initialize popover state for this filter\n\t\t\tvaluePopoverOpen[filterId] = false;\n\n\t\t\t// Handle contains operator on dates - parse the value format \"day:15\" or \"month:3\" or \"year:2024\"\n\t\t\tif (filterValue.operator === \"~~*\" && typeof filterValue.value === \"string\") {\n\t\t\t\tconst column = filterableCols.find((c) => c.id === cf.id);\n\t\t\t\tif (column && isDateColumn(column, table)) {\n\t\t\t\t\tconst parts = filterValue.value.split(\":\");\n\t\t\t\t\tif (parts.length === 2) {\n\t\t\t\t\t\tconst [datePart, datePartValue] = parts;\n\t\t\t\t\t\tif (datePart === \"day\" || datePart === \"month\" || datePart === \"year\") {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tid: filterId,\n\t\t\t\t\t\t\t\tcolumnId: cf.id,\n\t\t\t\t\t\t\t\toperator: filterValue.operator,\n\t\t\t\t\t\t\t\tvalue: null,\n\t\t\t\t\t\t\t\tdatePart: datePart as \"day\" | \"month\" | \"year\",\n\t\t\t\t\t\t\t\tdatePartValue,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tid: filterId,\n\t\t\t\tcolumnId: cf.id,\n\t\t\t\toperator: filterValue.operator,\n\t\t\t\tvalue: filterValue.value,\n\t\t\t\tvalue2: filterValue.value2,\n\t\t\t};\n\t\t});\n\t}\n\n\tfunction addFilter() {\n\t\tconst firstCol = filterableCols[0];\n\t\tif (!firstCol) return;\n\n\t\tconst newFilterId = crypto.randomUUID();\n\t\tdraftFilters = [\n\t\t\t...draftFilters,\n\t\t\t{\n\t\t\t\tid: newFilterId,\n\t\t\t\tcolumnId: firstCol.id,\n\t\t\t\toperator: \"=\",\n\t\t\t\tvalue: null,\n\t\t\t},\n\t\t];\n\t\t// Initialize the popover state for the new filter\n\t\tvaluePopoverOpen[newFilterId] = false;\n\t}\n\n\tfunction removeFilter(id: string) {\n\t\tdraftFilters = draftFilters.filter((f) => f.id !== id);\n\t\t// Clean up popover state\n\t\tdelete valuePopoverOpen[id];\n\t}\n\n\tfunction removeAllFilters() {\n\t\tdraftFilters = [];\n\t\tapplyFilters();\n\t}\n\n\tfunction applyFilters() {\n\t\t// Filter out incomplete rules\n\t\tconst validFilters = draftFilters.filter((f) => {\n\t\t\tif (f.operator === \"is_null\" || f.operator === \"is_not_null\") {\n\t\t\t\t// These operators don't need a value\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (f.operator === \"in\") {\n\t\t\t\treturn Array.isArray(f.value) && f.value.length > 0;\n\t\t\t}\n\t\t\tif (f.operator === \"between\") {\n\t\t\t\treturn f.value !== null && f.value !== \"\" && f.value2 !== null && f.value2 !== \"\";\n\t\t\t}\n\t\t\tif (f.operator === \"~~*\" && isDateFilter(f)) {\n\t\t\t\t// For \"enthält\" on dates, need datePart and datePartValue\n\t\t\t\treturn (\n\t\t\t\t\tf.datePart !== null &&\n\t\t\t\t\tf.datePart !== undefined &&\n\t\t\t\t\tf.datePartValue !== null &&\n\t\t\t\t\tf.datePartValue !== \"\"\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn f.value !== null && f.value !== \"\";\n\t\t});\n\n\t\t// Convert to TanStack Table format\n\t\tconst columnFilters = validFilters.map((f) => {\n\t\t\t// For \"enthält\" on dates, store datePart and datePartValue in the value\n\t\t\tif (f.operator === \"~~*\" && isDateFilter(f) && f.datePart && f.datePartValue) {\n\t\t\t\treturn {\n\t\t\t\t\tid: f.columnId,\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\toperator: f.operator,\n\t\t\t\t\t\tvalue: `${f.datePart}:${f.datePartValue}`, // Format: \"day:15\" or \"month:3\" or \"year:2024\"\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tid: f.columnId,\n\t\t\t\tvalue: {\n\t\t\t\t\toperator: f.operator,\n\t\t\t\t\tvalue: f.value,\n\t\t\t\t\t...(f.operator === \"between\" && f.value2 !== undefined ? { value2: f.value2 } : {}),\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\n\t\ttable.setColumnFilters(columnFilters);\n\t\tpopoverOpen = false;\n\t}\n\n\tfunction handleValueKeydown(event: KeyboardEvent) {\n\t\tif (event.key === \"Enter\") {\n\t\t\tapplyFilters();\n\t\t}\n\t}\n\n\tfunction getColumnOptions(columnId: string) {\n\t\tconst column = filterableCols.find((c) => c.id === columnId);\n\t\tif (!column) return [];\n\n\t\tconst uniqueValues = column.getFacetedUniqueValues();\n\t\treturn Array.from(uniqueValues.keys()).map((v) => ({\n\t\t\tlabel: String(v),\n\t\t\tvalue: String(v),\n\t\t}));\n\t}\n\n\tfunction updateFilterColumn(filterId: string, columnId: string) {\n\t\tdraftFilters = draftFilters.map((f) =>\n\t\t\tf.id === filterId\n\t\t\t\t? { ...f, columnId, value: null, value2: null, datePart: null, datePartValue: null }\n\t\t\t\t: f\n\t\t);\n\t}\n\n\tfunction updateFilterOperator(filterId: string, operator: FilterOperator) {\n\t\tdraftFilters = draftFilters.map((f) => {\n\t\t\tif (f.id !== filterId) return f;\n\t\t\t// Reset value when changing operator type\n\t\t\tlet newValue: string | string[] | null = null;\n\t\t\tlet newValue2: string | null = null;\n\t\t\tlet datePart: \"day\" | \"month\" | \"year\" | null = null;\n\t\t\tlet datePartValue: string | null = null;\n\t\t\tif (operator === \"in\") {\n\t\t\t\tnewValue = [];\n\t\t\t}\n\t\t\treturn { ...f, operator, value: newValue, value2: newValue2, datePart, datePartValue };\n\t\t});\n\t}\n\n\tfunction updateFilterValue(filterId: string, value: string | string[] | null) {\n\t\tdraftFilters = draftFilters.map((f) => (f.id === filterId ? { ...f, value } : f));\n\t}\n\n\tfunction updateFilterValue2(filterId: string, value2: string | null) {\n\t\tdraftFilters = draftFilters.map((f) => (f.id === filterId ? { ...f, value2 } : f));\n\t}\n\n\tfunction updateDatePart(filterId: string, datePart: \"day\" | \"month\" | \"year\" | null) {\n\t\tdraftFilters = draftFilters.map((f) =>\n\t\t\tf.id === filterId ? { ...f, datePart, datePartValue: null } : f\n\t\t);\n\t}\n\n\tfunction updateDatePartValue(filterId: string, datePartValue: string | null) {\n\t\tdraftFilters = draftFilters.map((f) => (f.id === filterId ? { ...f, datePartValue } : f));\n\t}\n\n\tfunction isDateFilter(filter: FilterRule): boolean {\n\t\tconst column = filterableCols.find((c) => c.id === filter.columnId);\n\t\treturn column ? isDateColumn(column, table) : false;\n\t}\n\n\tfunction toggleInValue(filterId: string, optionValue: string) {\n\t\tconst filter = draftFilters.find((f) => f.id === filterId);\n\t\tif (!filter) return;\n\n\t\tconst currentValues = Array.isArray(filter.value) ? filter.value : [];\n\t\tconst newValues = currentValues.includes(optionValue)\n\t\t\t? currentValues.filter((v) => v !== optionValue)\n\t\t\t: [...currentValues, optionValue];\n\n\t\tupdateFilterValue(filterId, newValues);\n\t}\n\n\tfunction getDisplayValue(filter: FilterRule): string {\n\t\tif (filter.value === null) return \"\";\n\t\tif (Array.isArray(filter.value)) {\n\t\t\tif (filter.value.length === 0) return \"\";\n\t\t\tif (filter.value.length === 1) return filter.value[0];\n\t\t\treturn `${filter.value.length} ausgewählt`;\n\t\t}\n\t\treturn String(filter.value);\n\t}\n\n\tfunction getOperatorsForFilter(filter: FilterRule) {\n\t\tconst column = filterableCols.find((c) => c.id === filter.columnId);\n\t\tif (!column) return [];\n\t\treturn getOperatorsForColumn(column, table);\n\t}\n</script>\n\n<Popover.Root\n\tbind:open={popoverOpen}\n\tonOpenChange={(open) => {\n\t\tif (open) {\n\t\t\tsyncFromTable();\n\t\t}\n\t}}\n>\n\t<Popover.Trigger>\n\t\t{#snippet child({ props })}\n\t\t\t<Button\n\t\t\t\t{...props}\n\t\t\t\tvariant=\"outline\"\n\t\t\t\tsize=\"sm\"\n\t\t\t\tclass=\"h-8 border {appliedFilterCount > 0\n\t\t\t\t\t? 'text-primary border border-[rgba(0,0,0,0.05)] bg-[rgba(0,0,0,0.07)]'\n\t\t\t\t\t: ''}\"\n\t\t\t>\n\t\t\t\t<FilterIcon class=\"size-4 {appliedFilterCount > 0 ? 'fill-current' : ''}\" />\n\t\t\t\t<span class=\"hidden md:inline\">\n\t\t\t\t\t{#if appliedFilterCount > 0}\n\t\t\t\t\t\tGefiltert nach {appliedFilterCount} {appliedFilterCount === 1 ? \"Regel\" : \"Regeln\"}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\tFiltern\n\t\t\t\t\t{/if}\n\t\t\t\t</span>\n\t\t\t</Button>\n\t\t{/snippet}\n\t</Popover.Trigger>\n\t<Popover.Content class=\"w-auto min-w-[400px] p-0\" align=\"start\">\n\t\t<div class=\"space-y-4 p-4\">\n\t\t\t{#if draftFilters.length === 0}\n\t\t\t\t<div class=\"space-y-1\">\n\t\t\t\t\t<p class=\"text-sm font-medium\">Keine Filter auf diese Ansicht angewendet</p>\n\t\t\t\t\t<p class=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\tSpalte unten hinzufügen, um die Ansicht zu filtern\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div class=\"space-y-2\">\n\t\t\t\t\t{#each draftFilters as filter (filter.id)}\n\t\t\t\t\t\t{@const column = filterableCols.find((c) => c.id === filter.columnId)}\n\t\t\t\t\t\t{@const options = getColumnOptions(filter.columnId)}\n\t\t\t\t\t\t{@const operators = getOperatorsForFilter(filter)}\n\t\t\t\t\t\t{@const operatorConfig = operators.find((op) => op.value === filter.operator)}\n\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<!-- Column Select -->\n\t\t\t\t\t\t\t<Select.Root\n\t\t\t\t\t\t\t\ttype=\"single\"\n\t\t\t\t\t\t\t\tvalue={filter.columnId}\n\t\t\t\t\t\t\t\tonValueChange={(value) => updateFilterColumn(filter.id, value)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Select.Trigger class=\"h-8 w-[140px]\" size=\"sm\">\n\t\t\t\t\t\t\t\t\t{column ? getColumnHeaderValue(column, table) : \"Spalte auswählen\"}\n\t\t\t\t\t\t\t\t</Select.Trigger>\n\t\t\t\t\t\t\t\t<Select.Content>\n\t\t\t\t\t\t\t\t\t{#each filterableCols as col (col.id)}\n\t\t\t\t\t\t\t\t\t\t<Select.Item value={col.id}>\n\t\t\t\t\t\t\t\t\t\t\t{getColumnHeaderValue(col, table)}\n\t\t\t\t\t\t\t\t\t\t</Select.Item>\n\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t</Select.Content>\n\t\t\t\t\t\t\t</Select.Root>\n\n\t\t\t\t\t\t\t<!-- Operator Select -->\n\t\t\t\t\t\t\t<Select.Root\n\t\t\t\t\t\t\t\ttype=\"single\"\n\t\t\t\t\t\t\t\tvalue={filter.operator}\n\t\t\t\t\t\t\t\tonValueChange={(value) => updateFilterOperator(filter.id, value as FilterOperator)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Select.Trigger class=\"h-8 w-[140px]\" size=\"sm\">\n\t\t\t\t\t\t\t\t\t{operatorConfig?.label || filter.operator}\n\t\t\t\t\t\t\t\t</Select.Trigger>\n\t\t\t\t\t\t\t\t<Select.Content>\n\t\t\t\t\t\t\t\t\t{#each operators as op (op.value)}\n\t\t\t\t\t\t\t\t\t\t<Select.Item value={op.value}>\n\t\t\t\t\t\t\t\t\t\t\t{op.label}\n\t\t\t\t\t\t\t\t\t\t</Select.Item>\n\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t</Select.Content>\n\t\t\t\t\t\t\t</Select.Root>\n\n\t\t\t\t\t\t\t<!-- Value Input -->\n\t\t\t\t\t\t\t{#if filter.operator === \"is_null\" || filter.operator === \"is_not_null\"}\n\t\t\t\t\t\t\t\t<!-- Null check operators - no value input needed -->\n\t\t\t\t\t\t\t\t<div class=\"text-muted-foreground flex h-8 w-[140px] items-center text-sm\">\n\t\t\t\t\t\t\t\t\t<!-- No input needed for these operators -->\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else if filter.operator === \"between\"}\n\t\t\t\t\t\t\t\t<!-- von...bis - two date inputs for date columns, text inputs otherwise -->\n\t\t\t\t\t\t\t\t{@const isDate = isDateFilter(filter)}\n\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t{#if isDate}\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={filter.value || \"\"}\n\t\t\t\t\t\t\t\t\t\t\toninput={(e) => updateFilterValue(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-full max-w-xs text-sm\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted-foreground text-xs\">bis</span>\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={filter.value2 || \"\"}\n\t\t\t\t\t\t\t\t\t\t\toninput={(e) => updateFilterValue2(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-full max-w-xs text-sm\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t<!-- Text inputs for non-date columns -->\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Von\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={filter.value || \"\"}\n\t\t\t\t\t\t\t\t\t\t\toninput={(e) => updateFilterValue(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\t\tonkeydown={handleValueKeydown}\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-[100px] text-sm\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted-foreground text-xs\">bis</span>\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"Bis\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={filter.value2 || \"\"}\n\t\t\t\t\t\t\t\t\t\t\toninput={(e) => updateFilterValue2(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\t\tonkeydown={handleValueKeydown}\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-[100px] text-sm\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else if filter.operator === \"~~*\" && isDateFilter(filter)}\n\t\t\t\t\t\t\t\t<!-- enthält operator for dates - special UI with Tag/Monat/Jahr selection -->\n\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-1\">\n\t\t\t\t\t\t\t\t\t<Select.Root\n\t\t\t\t\t\t\t\t\t\ttype=\"single\"\n\t\t\t\t\t\t\t\t\t\tvalue={filter.datePart || null}\n\t\t\t\t\t\t\t\t\t\tonValueChange={(value) =>\n\t\t\t\t\t\t\t\t\t\t\tupdateDatePart(filter.id, value as \"day\" | \"month\" | \"year\" | null)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Select.Trigger class=\"h-8 w-[100px]\" size=\"sm\">\n\t\t\t\t\t\t\t\t\t\t\t{filter.datePart\n\t\t\t\t\t\t\t\t\t\t\t\t? DATE_PARTS.find((p) => p.value === filter.datePart)?.label ||\n\t\t\t\t\t\t\t\t\t\t\t\t\tfilter.datePart\n\t\t\t\t\t\t\t\t\t\t\t\t: \"Wählen\"}\n\t\t\t\t\t\t\t\t\t\t</Select.Trigger>\n\t\t\t\t\t\t\t\t\t\t<Select.Content>\n\t\t\t\t\t\t\t\t\t\t\t{#each DATE_PARTS as part (part.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t<Select.Item value={part.value}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{part.label}\n\t\t\t\t\t\t\t\t\t\t\t\t</Select.Item>\n\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t</Select.Content>\n\t\t\t\t\t\t\t\t\t</Select.Root>\n\t\t\t\t\t\t\t\t\t{#if filter.datePart === \"month\"}\n\t\t\t\t\t\t\t\t\t\t<!-- Month dropdown -->\n\t\t\t\t\t\t\t\t\t\t<Select.Root\n\t\t\t\t\t\t\t\t\t\t\ttype=\"single\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={filter.datePartValue || null}\n\t\t\t\t\t\t\t\t\t\t\tonValueChange={(value) => updateDatePartValue(filter.id, value)}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Select.Trigger class=\"h-8 w-[120px]\" size=\"sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t{filter.datePartValue\n\t\t\t\t\t\t\t\t\t\t\t\t\t? MONTHS.find((m) => m.value === filter.datePartValue)?.label ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfilter.datePartValue\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"Wählen\"}\n\t\t\t\t\t\t\t\t\t\t\t</Select.Trigger>\n\t\t\t\t\t\t\t\t\t\t\t<Select.Content>\n\t\t\t\t\t\t\t\t\t\t\t\t{#each MONTHS as month (month.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Item value={month.value}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{month.label}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Select.Item>\n\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t</Select.Content>\n\t\t\t\t\t\t\t\t\t\t</Select.Root>\n\t\t\t\t\t\t\t\t\t{:else if filter.datePart === \"day\" || filter.datePart === \"year\"}\n\t\t\t\t\t\t\t\t\t\t<!-- Day or Year number input -->\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder={filter.datePart === \"day\" ? \"Tag (1-31)\" : \"Jahr\"}\n\t\t\t\t\t\t\t\t\t\t\tvalue={filter.datePartValue || \"\"}\n\t\t\t\t\t\t\t\t\t\t\toninput={(e) => updateDatePartValue(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\t\tonkeydown={handleValueKeydown}\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-[100px] text-sm\"\n\t\t\t\t\t\t\t\t\t\t\tmin={filter.datePart === \"day\" ? \"1\" : undefined}\n\t\t\t\t\t\t\t\t\t\t\tmax={filter.datePart === \"day\" ? \"31\" : undefined}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else if filter.operator === \"in\"}\n\t\t\t\t\t\t\t\t<!-- Multi-select value using Command -->\n\t\t\t\t\t\t\t\t<Popover.Root\n\t\t\t\t\t\t\t\t\topen={valuePopoverOpen[filter.id] ?? false}\n\t\t\t\t\t\t\t\t\tonOpenChange={(open) => (valuePopoverOpen[filter.id] = open)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Popover.Trigger>\n\t\t\t\t\t\t\t\t\t\t{#snippet child({ props })}\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-[140px] justify-start font-normal\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{#if Array.isArray(filter.value) && filter.value.length > 0}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{getDisplayValue(filter)}\n\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted-foreground\">Werte auswählen</span>\n\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/snippet}\n\t\t\t\t\t\t\t\t\t</Popover.Trigger>\n\t\t\t\t\t\t\t\t\t<Popover.Content class=\"w-[200px] p-0\" align=\"start\">\n\t\t\t\t\t\t\t\t\t\t<Command.Root>\n\t\t\t\t\t\t\t\t\t\t\t<Command.Input placeholder=\"Suchen...\" onkeydown={handleValueKeydown} />\n\t\t\t\t\t\t\t\t\t\t\t<Command.List>\n\t\t\t\t\t\t\t\t\t\t\t\t<Command.Empty>Keine Ergebnisse</Command.Empty>\n\t\t\t\t\t\t\t\t\t\t\t\t<Command.Group>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#each options as option (option.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{@const isSelected =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tArray.isArray(filter.value) && filter.value.includes(option.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Command.Item onSelect={() => toggleInValue(filter.id, option.value)}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"border-primary mr-2 flex size-4 items-center justify-center rounded-sm border\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisSelected\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-primary text-primary-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"opacity-50 [&_svg]:invisible\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<CheckIcon class=\"size-3 text-white\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>{option.label}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Command.Item>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t\t</Command.Group>\n\t\t\t\t\t\t\t\t\t\t\t</Command.List>\n\t\t\t\t\t\t\t\t\t\t</Command.Root>\n\t\t\t\t\t\t\t\t\t</Popover.Content>\n\t\t\t\t\t\t\t\t</Popover.Root>\n\t\t\t\t\t\t\t{:else if (filter.operator === \"=\" || filter.operator === \"<>\") && isDateFilter(filter)}\n\t\t\t\t\t\t\t\t<!-- gleich and ungleich for date columns - use date picker -->\n\t\t\t\t\t\t\t\t<Popover.Root>\n\t\t\t\t\t\t\t\t\t<Popover.Trigger>\n\t\t\t\t\t\t\t\t\t\t{#snippet child({ props })}\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-[140px] justify-start font-normal\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{filter.value || \"Datum auswählen\"}\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/snippet}\n\t\t\t\t\t\t\t\t\t</Popover.Trigger>\n\t\t\t\t\t\t\t\t\t<Popover.Content class=\"w-auto p-3\" align=\"start\">\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={filter.value || \"\"}\n\t\t\t\t\t\t\t\t\t\t\toninput={(e) => updateFilterValue(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-full text-sm\"\n\t\t\t\t\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</Popover.Content>\n\t\t\t\t\t\t\t\t</Popover.Root>\n\t\t\t\t\t\t\t{:else if operatorConfig?.isFreitext}\n\t\t\t\t\t\t\t\t<!-- Free text input or date input for date columns -->\n\t\t\t\t\t\t\t\t{@const isDate = isDateFilter(filter)}\n\t\t\t\t\t\t\t\t{#if isDate}\n\t\t\t\t\t\t\t\t\t<!-- Date picker for date columns -->\n\t\t\t\t\t\t\t\t\t<Popover.Root>\n\t\t\t\t\t\t\t\t\t\t<Popover.Trigger>\n\t\t\t\t\t\t\t\t\t\t\t{#snippet child({ props })}\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-[140px] justify-start font-normal\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{filter.value || \"Datum auswählen\"}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t{/snippet}\n\t\t\t\t\t\t\t\t\t\t</Popover.Trigger>\n\t\t\t\t\t\t\t\t\t\t<Popover.Content class=\"w-auto p-3\" align=\"start\">\n\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={filter.value || \"\"}\n\t\t\t\t\t\t\t\t\t\t\t\toninput={(e) => updateFilterValue(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-full text-sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</Popover.Content>\n\t\t\t\t\t\t\t\t\t</Popover.Root>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<!-- Text input for non-date columns -->\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Wert eingeben\"\n\t\t\t\t\t\t\t\t\t\tvalue={filter.value || \"\"}\n\t\t\t\t\t\t\t\t\t\toninput={(e) => updateFilterValue(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\tonkeydown={handleValueKeydown}\n\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-[140px] text-sm\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<!-- Single-select value using Command -->\n\t\t\t\t\t\t\t\t<Popover.Root\n\t\t\t\t\t\t\t\t\topen={valuePopoverOpen[filter.id] ?? false}\n\t\t\t\t\t\t\t\t\tonOpenChange={(open) => (valuePopoverOpen[filter.id] = open)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Popover.Trigger>\n\t\t\t\t\t\t\t\t\t\t{#snippet child({ props })}\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-[140px] justify-start font-normal\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{#if filter.value}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{filter.value}\n\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted-foreground\">Wert eingeben</span>\n\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/snippet}\n\t\t\t\t\t\t\t\t\t</Popover.Trigger>\n\t\t\t\t\t\t\t\t\t<Popover.Content class=\"w-[200px] p-0\" align=\"start\">\n\t\t\t\t\t\t\t\t\t\t<Command.Root>\n\t\t\t\t\t\t\t\t\t\t\t<Command.Input placeholder=\"Suchen...\" onkeydown={handleValueKeydown} />\n\t\t\t\t\t\t\t\t\t\t\t<Command.List>\n\t\t\t\t\t\t\t\t\t\t\t\t<Command.Empty>Keine Ergebnisse</Command.Empty>\n\t\t\t\t\t\t\t\t\t\t\t\t<Command.Group>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#each options as option (option.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{@const isSelected = filter.value === option.value}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Command.Item\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonSelect={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tupdateFilterValue(filter.id, option.value);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvaluePopoverOpen[filter.id] = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"mr-2 flex size-4 items-center justify-center\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisSelected ? \"opacity-100\" : \"opacity-0\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<CheckIcon class=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>{option.label}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Command.Item>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t\t</Command.Group>\n\t\t\t\t\t\t\t\t\t\t\t</Command.List>\n\t\t\t\t\t\t\t\t\t\t</Command.Root>\n\t\t\t\t\t\t\t\t\t</Popover.Content>\n\t\t\t\t\t\t\t\t</Popover.Root>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t<!-- Remove Button -->\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tclass=\"h-8 w-8 p-0\"\n\t\t\t\t\t\t\t\tonclick={() => removeFilter(filter.id)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<XIcon class=\"size-4\" />\n\t\t\t\t\t\t\t\t<span class=\"sr-only\">Filter entfernen</span>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<!-- Add Filter Button -->\n\t\t\t<Button variant=\"outline\" size=\"sm\" class=\"h-8 w-full border-dashed\" onclick={addFilter}>\n\t\t\t\t<PlusIcon class=\"mr-1 size-4\" />\n\t\t\t\tFilter hinzufügen\n\t\t\t</Button>\n\n\t\t\t<!-- Actions -->\n\t\t\t<div class=\"flex items-center justify-between border-t pt-2\">\n\t\t\t\t{#if draftFilters.length > 0}\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\tclass=\"text-destructive hover:text-destructive h-8\"\n\t\t\t\t\t\tonclick={removeAllFilters}\n\t\t\t\t\t>\n\t\t\t\t\t\tFilter entfernen\n\t\t\t\t\t</Button>\n\t\t\t\t{:else}\n\t\t\t\t\t<div></div>\n\t\t\t\t{/if}\n\t\t\t\t<Button size=\"sm\" class=\"h-8\" onclick={applyFilters} disabled={!hasChanges}>\n\t\t\t\t\tFilter anwenden\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\t</Popover.Content>\n</Popover.Root>\n",
			"type": "registry:component",
			"target": "blocks/data-table/data-table-filter-popover.svelte"
		},
		{
			"content": "<script lang=\"ts\" generics=\"TData\">\n\timport FilterIcon from \"@lucide/svelte/icons/filter\";\n\timport PlusIcon from \"@lucide/svelte/icons/plus\";\n\timport XIcon from \"@lucide/svelte/icons/x\";\n\timport CheckIcon from \"@lucide/svelte/icons/check\";\n\timport type { Column, Table } from \"@tanstack/table-core\";\n\timport * as Command from \"$lib/components/ui/command\";\n\timport * as Popover from \"$lib/components/ui/popover\";\n\timport * as Select from \"$lib/components/ui/select\";\n\timport { Button } from \"$lib/components/ui/button\";\n\timport { Input } from \"$lib/components/ui/input\";\n\timport { cn } from \"$UTILS$.js\";\n\timport {\n\t\ttype FilterOperator,\n\t\ttype FilterRule,\n\t\tgetOperatorsForColumn,\n\t\tisDateColumn,\n\t\tDATE_PARTS,\n\t\tMONTHS,\n\t} from \"./filter-operators.js\";\n\n\tlet {\n\t\ttable,\n\t\tcolumn,\n\t}: {\n\t\ttable: Table<TData>;\n\t\tcolumn: Column<TData, unknown>;\n\t} = $props();\n\n\t// Draft filters that are edited locally before applying\n\tlet draftFilters = $state<FilterRule[]>([]);\n\tlet popoverOpen = $state(false);\n\tlet valuePopoverOpen = $state<Record<string, boolean>>({});\n\n\t// Get available operators for this column\n\tconst operators = $derived(getOperatorsForColumn(column, table));\n\n\t// Check if this column has any active filters\n\tconst hasActiveFilter = $derived.by(() => {\n\t\tconst columnFilters = table.getState().columnFilters;\n\t\treturn columnFilters.some((f) => f.id === column.id);\n\t});\n\n\t// Count of filters for this column\n\tconst filterCount = $derived.by(() => {\n\t\tconst columnFilters = table.getState().columnFilters;\n\t\treturn columnFilters.filter((f) => f.id === column.id).length;\n\t});\n\n\t// Check if draft filters differ from applied filters for this column\n\tconst hasChanges = $derived.by(() => {\n\t\tconst columnFilters = table.getState().columnFilters;\n\t\tconst thisColumnFilters = columnFilters.filter((cf) => cf.id === column.id);\n\n\t\t// Filter out incomplete rules from draft\n\t\tconst validDraftFilters = draftFilters.filter((f) => {\n\t\t\tif (f.operator === \"is_null\" || f.operator === \"is_not_null\") {\n\t\t\t\t// These operators don't need a value\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (f.operator === \"in\") {\n\t\t\t\treturn Array.isArray(f.value) && f.value.length > 0;\n\t\t\t}\n\t\t\tif (f.operator === \"between\") {\n\t\t\t\treturn f.value !== null && f.value !== \"\" && f.value2 !== null && f.value2 !== \"\";\n\t\t\t}\n\t\t\tif (f.operator === \"~~*\" && isDateColumn(column, table)) {\n\t\t\t\t// For \"enthält\" on dates, need datePart and datePartValue\n\t\t\t\treturn (\n\t\t\t\t\tf.datePart !== null &&\n\t\t\t\t\tf.datePart !== undefined &&\n\t\t\t\t\tf.datePartValue !== null &&\n\t\t\t\t\tf.datePartValue !== \"\"\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn f.value !== null && f.value !== \"\";\n\t\t});\n\n\t\t// If counts differ, there are changes\n\t\tif (validDraftFilters.length !== thisColumnFilters.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// If both are empty, no changes\n\t\tif (validDraftFilters.length === 0 && thisColumnFilters.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Convert applied filters to a comparable format\n\t\tconst appliedFiltersNormalized = thisColumnFilters.map((cf) => {\n\t\t\tconst filterValue = cf.value as\n\t\t\t\t| { operator: FilterOperator; value: string | string[] | null; value2?: string | null }\n\t\t\t\t| string[];\n\t\t\tif (Array.isArray(filterValue)) {\n\t\t\t\treturn {\n\t\t\t\t\toperator: \"in\" as FilterOperator,\n\t\t\t\t\tvalue: filterValue,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn filterValue;\n\t\t});\n\n\t\t// Compare each draft filter with applied filters\n\t\tfor (const draftFilter of validDraftFilters) {\n\t\t\tconst matchingApplied = appliedFiltersNormalized.find((af) => {\n\t\t\t\tif (af.operator !== draftFilter.operator) return false;\n\n\t\t\t\t// Operators that don't require values - just check operator match\n\t\t\t\tif (draftFilter.operator === \"is_null\" || draftFilter.operator === \"is_not_null\") {\n\t\t\t\t\t// No value comparison needed for these operators\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Compare values\n\t\t\t\tif (Array.isArray(draftFilter.value) && Array.isArray(af.value)) {\n\t\t\t\t\tconst draftSet = new Set(draftFilter.value);\n\t\t\t\t\tconst appliedSet = new Set(af.value);\n\t\t\t\t\tif (draftSet.size !== appliedSet.size) return false;\n\t\t\t\t\tfor (const val of draftSet) {\n\t\t\t\t\t\tif (!appliedSet.has(val)) return false;\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tif (draftFilter.value !== af.value) return false;\n\n\t\t\t\t// Compare value2 for between operator\n\t\t\t\tif (draftFilter.operator === \"between\" && draftFilter.value2 !== af.value2) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Compare datePart and datePartValue for \"enthält\" on dates\n\t\t\t\tif (draftFilter.operator === \"~~*\" && isDateColumn(column, table)) {\n\t\t\t\t\tconst appliedValue = af.value as string;\n\t\t\t\t\tif (typeof appliedValue === \"string\" && appliedValue.includes(\":\")) {\n\t\t\t\t\t\tconst [appliedDatePart, appliedDatePartValue] = appliedValue.split(\":\");\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tdraftFilter.datePart !== appliedDatePart ||\n\t\t\t\t\t\t\tdraftFilter.datePartValue !== appliedDatePartValue\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false; // Format mismatch\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t\tif (!matchingApplied) return true;\n\t\t}\n\n\t\t// Also check if there are applied filters that don't match any draft filter\n\t\tfor (const appliedFilter of appliedFiltersNormalized) {\n\t\t\tconst matchingDraft = validDraftFilters.find((df) => {\n\t\t\t\tif (df.operator !== appliedFilter.operator) return false;\n\n\t\t\t\t// Operators that don't require values - just check operator match\n\t\t\t\tif (df.operator === \"is_null\" || df.operator === \"is_not_null\") {\n\t\t\t\t\t// No value comparison needed for these operators\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Compare values\n\t\t\t\tif (Array.isArray(df.value) && Array.isArray(appliedFilter.value)) {\n\t\t\t\t\tconst draftSet = new Set(df.value);\n\t\t\t\t\tconst appliedSet = new Set(appliedFilter.value);\n\t\t\t\t\tif (draftSet.size !== appliedSet.size) return false;\n\t\t\t\t\tfor (const val of draftSet) {\n\t\t\t\t\t\tif (!appliedSet.has(val)) return false;\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tif (df.value !== appliedFilter.value) return false;\n\n\t\t\t\t// Compare value2 for between operator\n\t\t\t\tif (df.operator === \"between\" && df.value2 !== appliedFilter.value2) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Compare datePart and datePartValue for \"enthält\" on dates\n\t\t\t\tif (df.operator === \"~~*\" && isDateColumn(column, table)) {\n\t\t\t\t\tconst appliedValue = appliedFilter.value as string;\n\t\t\t\t\tif (typeof appliedValue === \"string\" && appliedValue.includes(\":\")) {\n\t\t\t\t\t\tconst [appliedDatePart, appliedDatePartValue] = appliedValue.split(\":\");\n\t\t\t\t\t\tif (df.datePart !== appliedDatePart || df.datePartValue !== appliedDatePartValue) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false; // Format mismatch\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t\tif (!matchingDraft) return true;\n\t\t}\n\n\t\treturn false;\n\t});\n\n\t// Ensure popover state exists for all filters\n\t$effect(() => {\n\t\tfor (const filter of draftFilters) {\n\t\t\tif (!(filter.id in valuePopoverOpen)) {\n\t\t\t\tvaluePopoverOpen[filter.id] = false;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Initialize draft filters from table state when popover opens\n\tfunction syncFromTable() {\n\t\tconst columnFilters = table.getState().columnFilters;\n\t\tconst thisColumnFilters = columnFilters.filter((cf) => cf.id === column.id);\n\n\t\tdraftFilters = thisColumnFilters.map((cf) => {\n\t\t\tconst filterValue = cf.value as\n\t\t\t\t| { operator: FilterOperator; value: string | string[] | null; value2?: string | null }\n\t\t\t\t| string[];\n\t\t\tconst filterId = crypto.randomUUID();\n\n\t\t\t// Initialize popover state for this filter\n\t\t\tvaluePopoverOpen[filterId] = false;\n\n\t\t\t// Handle contains operator on dates - parse the value format \"day:15\" or \"month:3\" or \"year:2024\"\n\t\t\tif (\n\t\t\t\tfilterValue.operator === \"~~*\" &&\n\t\t\t\ttypeof filterValue.value === \"string\" &&\n\t\t\t\tisDateColumn(column, table)\n\t\t\t) {\n\t\t\t\tconst parts = filterValue.value.split(\":\");\n\t\t\t\tif (parts.length === 2) {\n\t\t\t\t\tconst [datePart, datePartValue] = parts;\n\t\t\t\t\tif (datePart === \"day\" || datePart === \"month\" || datePart === \"year\") {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tid: filterId,\n\t\t\t\t\t\t\toperator: filterValue.operator,\n\t\t\t\t\t\t\tvalue: null,\n\t\t\t\t\t\t\tdatePart: datePart as \"day\" | \"month\" | \"year\",\n\t\t\t\t\t\t\tdatePartValue,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tid: filterId,\n\t\t\t\toperator: filterValue.operator,\n\t\t\t\tvalue: filterValue.value,\n\t\t\t\tvalue2: filterValue.value2,\n\t\t\t};\n\t\t});\n\n\t\t// If no filters exist, add an empty one\n\t\tif (draftFilters.length === 0) {\n\t\t\taddFilter();\n\t\t}\n\t}\n\n\tfunction addFilter() {\n\t\tconst newFilterId = crypto.randomUUID();\n\t\tdraftFilters = [\n\t\t\t...draftFilters,\n\t\t\t{\n\t\t\t\tid: newFilterId,\n\t\t\t\toperator: \"=\",\n\t\t\t\tvalue: null,\n\t\t\t},\n\t\t];\n\t\t// Initialize the popover state for the new filter\n\t\tvaluePopoverOpen[newFilterId] = false;\n\t}\n\n\tfunction removeFilter(id: string) {\n\t\tdraftFilters = draftFilters.filter((f) => f.id !== id);\n\t\t// Clean up popover state\n\t\tdelete valuePopoverOpen[id];\n\t}\n\n\tfunction removeAllFilters() {\n\t\tdraftFilters = [];\n\t\tapplyFilters();\n\t}\n\n\tfunction applyFilters() {\n\t\t// Filter out incomplete rules\n\t\tconst validFilters = draftFilters.filter((f) => {\n\t\t\tif (f.operator === \"is_null\" || f.operator === \"is_not_null\") {\n\t\t\t\t// These operators don't need a value\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (f.operator === \"in\") {\n\t\t\t\treturn Array.isArray(f.value) && f.value.length > 0;\n\t\t\t}\n\t\t\tif (f.operator === \"between\") {\n\t\t\t\treturn f.value !== null && f.value !== \"\" && f.value2 !== null && f.value2 !== \"\";\n\t\t\t}\n\t\t\tif (f.operator === \"~~*\" && isDateColumn(column, table)) {\n\t\t\t\t// For \"enthält\" on dates, need datePart and datePartValue\n\t\t\t\treturn (\n\t\t\t\t\tf.datePart !== null &&\n\t\t\t\t\tf.datePart !== undefined &&\n\t\t\t\t\tf.datePartValue !== null &&\n\t\t\t\t\tf.datePartValue !== \"\"\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn f.value !== null && f.value !== \"\";\n\t\t});\n\n\t\t// Get existing filters for other columns\n\t\tconst existingFilters = table.getState().columnFilters.filter((cf) => cf.id !== column.id);\n\n\t\t// Convert our filters to TanStack Table format and add to existing\n\t\tconst newFilters = validFilters.map((f) => {\n\t\t\t// For \"enthält\" on dates, store datePart and datePartValue in the value\n\t\t\tif (f.operator === \"~~*\" && isDateColumn(column, table) && f.datePart && f.datePartValue) {\n\t\t\t\treturn {\n\t\t\t\t\tid: column.id,\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\toperator: f.operator,\n\t\t\t\t\t\tvalue: `${f.datePart}:${f.datePartValue}`, // Format: \"day:15\" or \"month:3\" or \"year:2024\"\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tid: column.id,\n\t\t\t\tvalue: {\n\t\t\t\t\toperator: f.operator,\n\t\t\t\t\tvalue: f.value,\n\t\t\t\t\t...(f.operator === \"between\" && f.value2 !== undefined ? { value2: f.value2 } : {}),\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\n\t\ttable.setColumnFilters([...existingFilters, ...newFilters]);\n\t\tpopoverOpen = false;\n\t}\n\n\tfunction handleValueKeydown(event: KeyboardEvent) {\n\t\tif (event.key === \"Enter\") {\n\t\t\tapplyFilters();\n\t\t}\n\t}\n\n\tfunction getColumnOptions() {\n\t\tconst uniqueValues = column.getFacetedUniqueValues();\n\t\treturn Array.from(uniqueValues.keys()).map((v) => ({\n\t\t\tlabel: String(v),\n\t\t\tvalue: String(v),\n\t\t}));\n\t}\n\n\tfunction updateFilterOperator(filterId: string, operator: FilterOperator) {\n\t\tdraftFilters = draftFilters.map((f) => {\n\t\t\tif (f.id !== filterId) return f;\n\t\t\t// Reset value when changing operator type\n\t\t\tlet newValue: string | string[] | null = null;\n\t\t\tlet newValue2: string | null = null;\n\t\t\tlet datePart: \"day\" | \"month\" | \"year\" | null = null;\n\t\t\tlet datePartValue: string | null = null;\n\t\t\tif (operator === \"in\") {\n\t\t\t\tnewValue = [];\n\t\t\t}\n\t\t\treturn { ...f, operator, value: newValue, value2: newValue2, datePart, datePartValue };\n\t\t});\n\t}\n\n\tfunction updateFilterValue(filterId: string, value: string | string[] | null) {\n\t\tdraftFilters = draftFilters.map((f) => (f.id === filterId ? { ...f, value } : f));\n\t}\n\n\tfunction updateFilterValue2(filterId: string, value2: string | null) {\n\t\tdraftFilters = draftFilters.map((f) => (f.id === filterId ? { ...f, value2 } : f));\n\t}\n\n\tfunction updateDatePart(filterId: string, datePart: \"day\" | \"month\" | \"year\" | null) {\n\t\tdraftFilters = draftFilters.map((f) =>\n\t\t\tf.id === filterId ? { ...f, datePart, datePartValue: null } : f\n\t\t);\n\t}\n\n\tfunction updateDatePartValue(filterId: string, datePartValue: string | null) {\n\t\tdraftFilters = draftFilters.map((f) => (f.id === filterId ? { ...f, datePartValue } : f));\n\t}\n\n\tfunction toggleInValue(filterId: string, optionValue: string) {\n\t\tconst filter = draftFilters.find((f) => f.id === filterId);\n\t\tif (!filter) return;\n\n\t\tconst currentValues = Array.isArray(filter.value) ? filter.value : [];\n\t\tconst newValues = currentValues.includes(optionValue)\n\t\t\t? currentValues.filter((v) => v !== optionValue)\n\t\t\t: [...currentValues, optionValue];\n\n\t\tupdateFilterValue(filterId, newValues);\n\t}\n\n\tfunction getDisplayValue(filter: FilterRule): string {\n\t\tif (filter.value === null) return \"\";\n\t\tif (Array.isArray(filter.value)) {\n\t\t\tif (filter.value.length === 0) return \"\";\n\t\t\tif (filter.value.length === 1) return filter.value[0];\n\t\t\treturn `${filter.value.length} ausgewählt`;\n\t\t}\n\t\treturn String(filter.value);\n\t}\n\n\tconst options = $derived(getColumnOptions());\n</script>\n\n<Popover.Root\n\tbind:open={popoverOpen}\n\tonOpenChange={(open) => {\n\t\tif (open) {\n\t\t\tsyncFromTable();\n\t\t}\n\t}}\n>\n\t<Popover.Trigger>\n\t\t{#snippet child({ props })}\n\t\t\t<button\n\t\t\t\t{...props}\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass={cn(\n\t\t\t\t\t\"inline-flex size-6 items-center justify-center rounded hover:bg-[#00000010]\",\n\t\t\t\t\thasActiveFilter ? \"text-primary\" : \"text-muted-foreground\"\n\t\t\t\t)}\n\t\t\t\tonmousedown={(e) => e.stopPropagation()}\n\t\t\t>\n\t\t\t\t{#if hasActiveFilter}\n\t\t\t\t\t<FilterIcon class=\"size-3.5 fill-current\" />\n\t\t\t\t{:else}\n\t\t\t\t\t<FilterIcon class=\"size-3.5\" />\n\t\t\t\t{/if}\n\t\t\t\t<span class=\"sr-only\">Spalte filtern</span>\n\t\t\t</button>\n\t\t{/snippet}\n\t</Popover.Trigger>\n\t<Popover.Content class=\"w-auto min-w-[320px] p-0\" align=\"start\">\n\t\t<div class=\"space-y-4 p-4\">\n\t\t\t<div class=\"space-y-2\">\n\t\t\t\t{#each draftFilters as filter (filter.id)}\n\t\t\t\t\t{@const operatorConfig = operators.find((op) => op.value === filter.operator)}\n\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t<!-- Operator Select -->\n\t\t\t\t\t\t<Select.Root\n\t\t\t\t\t\t\ttype=\"single\"\n\t\t\t\t\t\t\tvalue={filter.operator}\n\t\t\t\t\t\t\tonValueChange={(value) => updateFilterOperator(filter.id, value as FilterOperator)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Select.Trigger class=\"h-8 w-[140px]\" size=\"sm\">\n\t\t\t\t\t\t\t\t{operatorConfig?.label || filter.operator}\n\t\t\t\t\t\t\t</Select.Trigger>\n\t\t\t\t\t\t\t<Select.Content>\n\t\t\t\t\t\t\t\t{#each operators as op (op.value)}\n\t\t\t\t\t\t\t\t\t<Select.Item value={op.value}>\n\t\t\t\t\t\t\t\t\t\t{op.label}\n\t\t\t\t\t\t\t\t\t</Select.Item>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</Select.Content>\n\t\t\t\t\t\t</Select.Root>\n\n\t\t\t\t\t\t<!-- Value Input -->\n\t\t\t\t\t\t{#if filter.operator === \"is_null\" || filter.operator === \"is_not_null\"}\n\t\t\t\t\t\t\t<!-- Null check operators - no value input needed -->\n\t\t\t\t\t\t\t<div class=\"text-muted-foreground flex h-8 flex-1 items-center text-sm\">\n\t\t\t\t\t\t\t\t<!-- No input needed for these operators -->\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else if filter.operator === \"between\"}\n\t\t\t\t\t\t\t<!-- von...bis - two date inputs for date columns, text inputs otherwise -->\n\t\t\t\t\t\t\t{@const isDate = isDateColumn(column, table)}\n\t\t\t\t\t\t\t<div class=\"flex flex-1 items-center gap-1\">\n\t\t\t\t\t\t\t\t{#if isDate}\n\t\t\t\t\t\t\t\t\t<!-- Date picker for date columns -->\n\t\t\t\t\t\t\t\t\t<Popover.Root>\n\t\t\t\t\t\t\t\t\t\t<Popover.Trigger>\n\t\t\t\t\t\t\t\t\t\t\t{#snippet child({ props: innerProps })}\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t{...innerProps}\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 flex-1 justify-start font-normal\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{filter.value || \"Von\"}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t{/snippet}\n\t\t\t\t\t\t\t\t\t\t</Popover.Trigger>\n\t\t\t\t\t\t\t\t\t\t<Popover.Content class=\"w-auto p-3\" align=\"start\">\n\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={filter.value || \"\"}\n\t\t\t\t\t\t\t\t\t\t\t\toninput={(e) => updateFilterValue(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-full text-sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</Popover.Content>\n\t\t\t\t\t\t\t\t\t</Popover.Root>\n\t\t\t\t\t\t\t\t\t<span class=\"text-muted-foreground text-xs\">bis</span>\n\t\t\t\t\t\t\t\t\t<Popover.Root>\n\t\t\t\t\t\t\t\t\t\t<Popover.Trigger>\n\t\t\t\t\t\t\t\t\t\t\t{#snippet child({ props: innerProps })}\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t{...innerProps}\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 flex-1 justify-start font-normal\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{filter.value2 || \"Bis\"}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t{/snippet}\n\t\t\t\t\t\t\t\t\t\t</Popover.Trigger>\n\t\t\t\t\t\t\t\t\t\t<Popover.Content class=\"w-auto p-3\" align=\"start\">\n\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={filter.value2 || \"\"}\n\t\t\t\t\t\t\t\t\t\t\t\toninput={(e) => updateFilterValue2(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-full text-sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</Popover.Content>\n\t\t\t\t\t\t\t\t\t</Popover.Root>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<!-- Text inputs for non-date columns -->\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Von\"\n\t\t\t\t\t\t\t\t\t\tvalue={filter.value || \"\"}\n\t\t\t\t\t\t\t\t\t\toninput={(e) => updateFilterValue(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\tonkeydown={handleValueKeydown}\n\t\t\t\t\t\t\t\t\t\tclass=\"h-8 flex-1 text-sm\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<span class=\"text-muted-foreground text-xs\">bis</span>\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Bis\"\n\t\t\t\t\t\t\t\t\t\tvalue={filter.value2 || \"\"}\n\t\t\t\t\t\t\t\t\t\toninput={(e) => updateFilterValue2(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\tonkeydown={handleValueKeydown}\n\t\t\t\t\t\t\t\t\t\tclass=\"h-8 flex-1 text-sm\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else if filter.operator === \"~~*\" && isDateColumn(column, table)}\n\t\t\t\t\t\t\t<!-- enthält operator for dates - special UI with Tag/Monat/Jahr selection -->\n\t\t\t\t\t\t\t<div class=\"flex flex-1 items-center gap-1\">\n\t\t\t\t\t\t\t\t<Select.Root\n\t\t\t\t\t\t\t\t\ttype=\"single\"\n\t\t\t\t\t\t\t\t\tvalue={filter.datePart || null}\n\t\t\t\t\t\t\t\t\tonValueChange={(value) =>\n\t\t\t\t\t\t\t\t\t\tupdateDatePart(filter.id, value as \"day\" | \"month\" | \"year\" | null)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Select.Trigger class=\"h-8 w-[100px]\" size=\"sm\">\n\t\t\t\t\t\t\t\t\t\t{filter.datePart\n\t\t\t\t\t\t\t\t\t\t\t? DATE_PARTS.find((p) => p.value === filter.datePart)?.label ||\n\t\t\t\t\t\t\t\t\t\t\t\tfilter.datePart\n\t\t\t\t\t\t\t\t\t\t\t: \"Wählen\"}\n\t\t\t\t\t\t\t\t\t</Select.Trigger>\n\t\t\t\t\t\t\t\t\t<Select.Content>\n\t\t\t\t\t\t\t\t\t\t{#each DATE_PARTS as part (part.value)}\n\t\t\t\t\t\t\t\t\t\t\t<Select.Item value={part.value}>\n\t\t\t\t\t\t\t\t\t\t\t\t{part.label}\n\t\t\t\t\t\t\t\t\t\t\t</Select.Item>\n\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t</Select.Content>\n\t\t\t\t\t\t\t\t</Select.Root>\n\t\t\t\t\t\t\t\t{#if filter.datePart === \"month\"}\n\t\t\t\t\t\t\t\t\t<!-- Month dropdown -->\n\t\t\t\t\t\t\t\t\t<Select.Root\n\t\t\t\t\t\t\t\t\t\ttype=\"single\"\n\t\t\t\t\t\t\t\t\t\tvalue={filter.datePartValue || null}\n\t\t\t\t\t\t\t\t\t\tonValueChange={(value) => updateDatePartValue(filter.id, value)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Select.Trigger class=\"h-8 flex-1\" size=\"sm\">\n\t\t\t\t\t\t\t\t\t\t\t{filter.datePartValue\n\t\t\t\t\t\t\t\t\t\t\t\t? MONTHS.find((m) => m.value === filter.datePartValue)?.label ||\n\t\t\t\t\t\t\t\t\t\t\t\t\tfilter.datePartValue\n\t\t\t\t\t\t\t\t\t\t\t\t: \"Wählen\"}\n\t\t\t\t\t\t\t\t\t\t</Select.Trigger>\n\t\t\t\t\t\t\t\t\t\t<Select.Content>\n\t\t\t\t\t\t\t\t\t\t\t{#each MONTHS as month (month.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t<Select.Item value={month.value}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{month.label}\n\t\t\t\t\t\t\t\t\t\t\t\t</Select.Item>\n\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t</Select.Content>\n\t\t\t\t\t\t\t\t\t</Select.Root>\n\t\t\t\t\t\t\t\t{:else if filter.datePart === \"day\" || filter.datePart === \"year\"}\n\t\t\t\t\t\t\t\t\t<!-- Day or Year number input -->\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t\tplaceholder={filter.datePart === \"day\" ? \"Tag (1-31)\" : \"Jahr\"}\n\t\t\t\t\t\t\t\t\t\tvalue={filter.datePartValue || \"\"}\n\t\t\t\t\t\t\t\t\t\toninput={(e) => updateDatePartValue(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\tonkeydown={handleValueKeydown}\n\t\t\t\t\t\t\t\t\t\tclass=\"h-8 flex-1 text-sm\"\n\t\t\t\t\t\t\t\t\t\tmin={filter.datePart === \"day\" ? \"1\" : undefined}\n\t\t\t\t\t\t\t\t\t\tmax={filter.datePart === \"day\" ? \"31\" : undefined}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else if filter.operator === \"in\"}\n\t\t\t\t\t\t\t<!-- Multi-select value using Command -->\n\t\t\t\t\t\t\t<Popover.Root\n\t\t\t\t\t\t\t\topen={valuePopoverOpen[filter.id] ?? false}\n\t\t\t\t\t\t\t\tonOpenChange={(open) => (valuePopoverOpen[filter.id] = open)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Popover.Trigger>\n\t\t\t\t\t\t\t\t\t{#snippet child({ props: innerProps })}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t{...innerProps}\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 flex-1 justify-start font-normal\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{#if Array.isArray(filter.value) && filter.value.length > 0}\n\t\t\t\t\t\t\t\t\t\t\t\t{getDisplayValue(filter)}\n\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted-foreground\">Werte auswählen</span>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t{/snippet}\n\t\t\t\t\t\t\t\t</Popover.Trigger>\n\t\t\t\t\t\t\t\t<Popover.Content class=\"w-[200px] p-0\" align=\"start\">\n\t\t\t\t\t\t\t\t\t<Command.Root>\n\t\t\t\t\t\t\t\t\t\t<Command.Input placeholder=\"Suchen...\" onkeydown={handleValueKeydown} />\n\t\t\t\t\t\t\t\t\t\t<Command.List>\n\t\t\t\t\t\t\t\t\t\t\t<Command.Empty>Keine Ergebnisse</Command.Empty>\n\t\t\t\t\t\t\t\t\t\t\t<Command.Group>\n\t\t\t\t\t\t\t\t\t\t\t\t{#each options as option (option.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{@const isSelected =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tArray.isArray(filter.value) && filter.value.includes(option.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Command.Item onSelect={() => toggleInValue(filter.id, option.value)}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"border-primary mr-2 flex size-4 items-center justify-center rounded-sm border\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisSelected\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"bg-primary text-primary-foreground\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"opacity-50 [&_svg]:invisible\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<CheckIcon class=\"size-3 text-white\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>{option.label}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Command.Item>\n\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t</Command.Group>\n\t\t\t\t\t\t\t\t\t\t</Command.List>\n\t\t\t\t\t\t\t\t\t</Command.Root>\n\t\t\t\t\t\t\t\t</Popover.Content>\n\t\t\t\t\t\t\t</Popover.Root>\n\t\t\t\t\t\t{:else if (filter.operator === \"=\" || filter.operator === \"<>\") && isDateColumn(column, table)}\n\t\t\t\t\t\t\t<!-- gleich and ungleich for date columns - use date picker -->\n\t\t\t\t\t\t\t<Popover.Root>\n\t\t\t\t\t\t\t\t<Popover.Trigger>\n\t\t\t\t\t\t\t\t\t{#snippet child({ props: innerProps })}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t{...innerProps}\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 flex-1 justify-start font-normal\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{filter.value || \"Datum auswählen\"}\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t{/snippet}\n\t\t\t\t\t\t\t\t</Popover.Trigger>\n\t\t\t\t\t\t\t\t<Popover.Content class=\"w-auto p-3\" align=\"start\">\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\t\t\tvalue={filter.value || \"\"}\n\t\t\t\t\t\t\t\t\t\toninput={(e) => updateFilterValue(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-full text-sm\"\n\t\t\t\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</Popover.Content>\n\t\t\t\t\t\t\t</Popover.Root>\n\t\t\t\t\t\t{:else if operatorConfig?.isFreitext}\n\t\t\t\t\t\t\t<!-- Free text input or date input for date columns -->\n\t\t\t\t\t\t\t{#if isDateColumn(column, table)}\n\t\t\t\t\t\t\t\t<!-- Date picker for date columns -->\n\t\t\t\t\t\t\t\t<Popover.Root>\n\t\t\t\t\t\t\t\t\t<Popover.Trigger>\n\t\t\t\t\t\t\t\t\t\t{#snippet child({ props: innerProps })}\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t{...innerProps}\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 flex-1 justify-start font-normal\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{filter.value || \"Datum auswählen\"}\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t{/snippet}\n\t\t\t\t\t\t\t\t\t</Popover.Trigger>\n\t\t\t\t\t\t\t\t\t<Popover.Content class=\"w-auto p-3\" align=\"start\">\n\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={filter.value || \"\"}\n\t\t\t\t\t\t\t\t\t\t\toninput={(e) => updateFilterValue(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 w-full text-sm\"\n\t\t\t\t\t\t\t\t\t\t\tautofocus\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</Popover.Content>\n\t\t\t\t\t\t\t\t</Popover.Root>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<!-- Text input for non-date columns -->\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"Wert eingeben\"\n\t\t\t\t\t\t\t\t\tvalue={filter.value || \"\"}\n\t\t\t\t\t\t\t\t\toninput={(e) => updateFilterValue(filter.id, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\tonkeydown={handleValueKeydown}\n\t\t\t\t\t\t\t\t\tclass=\"h-8 flex-1 text-sm\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<!-- Single-select value using Command -->\n\t\t\t\t\t\t\t<Popover.Root\n\t\t\t\t\t\t\t\topen={valuePopoverOpen[filter.id] ?? false}\n\t\t\t\t\t\t\t\tonOpenChange={(open) => (valuePopoverOpen[filter.id] = open)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Popover.Trigger>\n\t\t\t\t\t\t\t\t\t{#snippet child({ props: innerProps })}\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t{...innerProps}\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-8 flex-1 justify-start font-normal\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{#if filter.value}\n\t\t\t\t\t\t\t\t\t\t\t\t{filter.value}\n\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-muted-foreground\">Wert eingeben</span>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t{/snippet}\n\t\t\t\t\t\t\t\t</Popover.Trigger>\n\t\t\t\t\t\t\t\t<Popover.Content class=\"w-[200px] p-0\" align=\"start\">\n\t\t\t\t\t\t\t\t\t<Command.Root>\n\t\t\t\t\t\t\t\t\t\t<Command.Input placeholder=\"Suchen...\" onkeydown={handleValueKeydown} />\n\t\t\t\t\t\t\t\t\t\t<Command.List>\n\t\t\t\t\t\t\t\t\t\t\t<Command.Empty>Keine Ergebnisse</Command.Empty>\n\t\t\t\t\t\t\t\t\t\t\t<Command.Group>\n\t\t\t\t\t\t\t\t\t\t\t\t{#each options as option (option.value)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{@const isSelected = filter.value === option.value}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Command.Item\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonSelect={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tupdateFilterValue(filter.id, option.value);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvaluePopoverOpen[filter.id] = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"mr-2 flex size-4 items-center justify-center\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisSelected ? \"opacity-100\" : \"opacity-0\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<CheckIcon class=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>{option.label}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Command.Item>\n\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t</Command.Group>\n\t\t\t\t\t\t\t\t\t\t</Command.List>\n\t\t\t\t\t\t\t\t\t</Command.Root>\n\t\t\t\t\t\t\t\t</Popover.Content>\n\t\t\t\t\t\t\t</Popover.Root>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<!-- Remove Button -->\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tclass=\"h-8 w-8 shrink-0 p-0\"\n\t\t\t\t\t\t\tonclick={() => removeFilter(filter.id)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<XIcon class=\"size-4\" />\n\t\t\t\t\t\t\t<span class=\"sr-only\">Filter entfernen</span>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t{/each}\n\t\t\t</div>\n\n\t\t\t<!-- Add Filter Button -->\n\t\t\t<Button variant=\"outline\" size=\"sm\" class=\"h-8 w-full border-dashed\" onclick={addFilter}>\n\t\t\t\t<PlusIcon class=\"mr-1 size-4\" />\n\t\t\t\tFilter hinzufügen\n\t\t\t</Button>\n\n\t\t\t<!-- Actions -->\n\t\t\t<div class=\"flex items-center justify-between border-t pt-2\">\n\t\t\t\t{#if draftFilters.length > 0}\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\tclass=\"text-destructive hover:text-destructive h-8\"\n\t\t\t\t\t\tonclick={removeAllFilters}\n\t\t\t\t\t>\n\t\t\t\t\t\tFilter löschen\n\t\t\t\t\t</Button>\n\t\t\t\t{:else}\n\t\t\t\t\t<div></div>\n\t\t\t\t{/if}\n\t\t\t\t<Button size=\"sm\" class=\"h-8\" onclick={applyFilters} disabled={!hasChanges}>\n\t\t\t\t\tAnwenden\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\t</Popover.Content>\n</Popover.Root>\n",
			"type": "registry:component",
			"target": "blocks/data-table/data-table-column-filter.svelte"
		},
		{
			"content": "<script lang=\"ts\" generics=\"TData\">\n\timport GripVerticalIcon from \"@lucide/svelte/icons/grip-vertical\";\n\timport PlusIcon from \"@lucide/svelte/icons/plus\";\n\timport XIcon from \"@lucide/svelte/icons/x\";\n\timport ArrowUpDownIcon from \"@lucide/svelte/icons/arrow-up-down\";\n\timport ChevronsUpDownIcon from \"@lucide/svelte/icons/chevrons-up-down\";\n\timport type { Column, Table } from \"@tanstack/table-core\";\n\timport * as Popover from \"$lib/components/ui/popover\";\n\timport * as Select from \"$lib/components/ui/select\";\n\timport { Button } from \"$lib/components/ui/button\";\n\timport { Switch } from \"$lib/components/ui/switch\";\n\timport { cn } from \"$UTILS$.js\";\n\timport { getColumnHeaderValue } from \"./utils.js\";\n\timport { dndzone } from \"svelte-dnd-action\";\n\timport { tick } from \"svelte\";\n\n\ttype SortRule = {\n\t\tid: string;\n\t\tcolumnId: string;\n\t\tdesc: boolean;\n\t};\n\n\tlet {\n\t\ttable,\n\t\tsortableCols,\n\t}: {\n\t\ttable: Table<TData>;\n\t\tsortableCols: Column<TData, unknown>[];\n\t} = $props();\n\n\t// Draft sort rules that are edited locally before applying\n\tlet draftSortRules = $state<SortRule[]>([]);\n\tlet popoverOpen = $state(false);\n\n\t// Count of applied sort rules\n\tconst appliedSortCount = $derived(table.getState().sorting.length);\n\n\t// Check if draft sort rules differ from applied sorting\n\tconst hasChanges = $derived.by(() => {\n\t\tconst appliedSorting = table.getState().sorting;\n\n\t\t// If counts differ, there are changes\n\t\tif (draftSortRules.length !== appliedSorting.length) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Compare order and values - order matters for sorting priority\n\t\tfor (let i = 0; i < draftSortRules.length; i++) {\n\t\t\tconst draftRule = draftSortRules[i];\n\t\t\tconst appliedRule = appliedSorting[i];\n\n\t\t\tif (!appliedRule) return true;\n\t\t\tif (draftRule.columnId !== appliedRule.id) return true;\n\t\t\tif ((draftRule.desc ?? false) !== (appliedRule.desc ?? false)) return true;\n\t\t}\n\n\t\treturn false;\n\t});\n\n\t// Initialize draft sort rules from table state when popover opens\n\tfunction syncFromTable() {\n\t\tconst sorting = table.getState().sorting;\n\t\tdraftSortRules = sorting.map((sort) => ({\n\t\t\tid: crypto.randomUUID(),\n\t\t\tcolumnId: sort.id,\n\t\t\tdesc: sort.desc ?? false,\n\t\t}));\n\t}\n\n\tfunction addSortRule() {\n\t\tconst firstCol = sortableCols[0];\n\t\tif (!firstCol) return;\n\n\t\t// Find a column that's not already in the sort rules\n\t\tconst usedColumnIds = new Set(draftSortRules.map((r) => r.columnId));\n\t\tconst availableCol = sortableCols.find((col) => !usedColumnIds.has(col.id)) || firstCol;\n\n\t\tdraftSortRules = [\n\t\t\t...draftSortRules,\n\t\t\t{\n\t\t\t\tid: crypto.randomUUID(),\n\t\t\t\tcolumnId: availableCol.id,\n\t\t\t\tdesc: false,\n\t\t\t},\n\t\t];\n\t}\n\n\tfunction removeSortRule(id: string) {\n\t\tdraftSortRules = draftSortRules.filter((r) => r.id !== id);\n\t}\n\n\tfunction removeAllSortRules() {\n\t\tdraftSortRules = [];\n\t\tapplySorting();\n\t}\n\n\tasync function applySorting() {\n\t\t// Convert to TanStack Table format\n\t\tconst sorting = draftSortRules.map((rule) => ({\n\t\t\tid: rule.columnId,\n\t\t\tdesc: rule.desc,\n\t\t}));\n\n\t\ttable.setSorting(sorting);\n\t\t// Wait for state to update before closing popover\n\t\tawait tick();\n\t\tpopoverOpen = false;\n\t}\n\n\tfunction updateSortColumn(ruleId: string, columnId: string) {\n\t\tdraftSortRules = draftSortRules.map((r) => (r.id === ruleId ? { ...r, columnId } : r));\n\t}\n\n\tfunction handleDndEvent(e: CustomEvent) {\n\t\tconst { items } = e.detail;\n\t\tdraftSortRules = items;\n\t}\n\n\tfunction getSortLabel(index: number): string {\n\t\tif (index === 0) return \"Sortieren nach\";\n\t\treturn \"dann nach\";\n\t}\n</script>\n\n<Popover.Root\n\tbind:open={popoverOpen}\n\tonOpenChange={(open) => {\n\t\tif (open) {\n\t\t\tsyncFromTable();\n\t\t}\n\t}}\n>\n\t<Popover.Trigger>\n\t\t{#snippet child({ props })}\n\t\t\t<Button\n\t\t\t\t{...props}\n\t\t\t\tvariant=\"outline\"\n\t\t\t\tsize=\"sm\"\n\t\t\t\tclass=\"h-8 border {appliedSortCount > 0\n\t\t\t\t\t? 'text-primary border border-[rgba(0,0,0,0.05)] bg-[rgba(0,0,0,0.07)]'\n\t\t\t\t\t: ''}\"\n\t\t\t>\n\t\t\t\t{#if appliedSortCount > 0}\n\t\t\t\t\t<ArrowUpDownIcon class=\"size-4 fill-current\" />\n\t\t\t\t{:else}\n\t\t\t\t\t<ChevronsUpDownIcon class=\"size-4\" />\n\t\t\t\t{/if}\n\t\t\t\t<span class=\"hidden md:inline\">\n\t\t\t\t\t{#if appliedSortCount > 0}\n\t\t\t\t\t\tSortiert nach {appliedSortCount} {appliedSortCount === 1 ? \"Regel\" : \"Regeln\"}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\tSortieren\n\t\t\t\t\t{/if}\n\t\t\t\t</span>\n\t\t\t</Button>\n\t\t{/snippet}\n\t</Popover.Trigger>\n\t<Popover.Content class=\"w-auto min-w-[400px] p-0\" align=\"start\">\n\t\t<div class=\"space-y-4 p-4\">\n\t\t\t{#if draftSortRules.length === 0}\n\t\t\t\t<div class=\"space-y-1\">\n\t\t\t\t\t<p class=\"text-sm font-medium\">Keine Sortierung auf diese Ansicht angewendet</p>\n\t\t\t\t\t<p class=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\tSpalte unten hinzufügen, um die Ansicht zu sortieren\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<!-- svelte-ignore a11y_no_static_element_interactions -->\n\t\t\t\t<div\n\t\t\t\t\tclass=\"dnd-sort-zone space-y-2 rounded-md p-2\"\n\t\t\t\t\tuse:dndzone={{\n\t\t\t\t\t\titems: draftSortRules,\n\t\t\t\t\t\tflipDurationMs: 150,\n\t\t\t\t\t\tdropTargetStyle: {},\n\t\t\t\t\t}}\n\t\t\t\t\tonconsider={handleDndEvent}\n\t\t\t\t\tonfinalize={handleDndEvent}\n\t\t\t\t>\n\t\t\t\t\t{#each draftSortRules as sortRule, index (sortRule.id)}\n\t\t\t\t\t\t{@const column = sortableCols.find((c) => c.id === sortRule.columnId)}\n\t\t\t\t\t\t{@const ascending = !sortRule.desc}\n\t\t\t\t\t\t{@const switchId = `sort-switch-${sortRule.id}`}\n\t\t\t\t\t\t<div class=\"flex items-center gap-2\" data-id={sortRule.id}>\n\t\t\t\t\t\t\t<!-- Drag Handle -->\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"text-muted-foreground hover:text-foreground cursor-grab active:cursor-grabbing\"\n\t\t\t\t\t\t\t\taria-label=\"Zum Neuordnen ziehen\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<GripVerticalIcon class=\"size-4\" />\n\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t<!-- Bordered Content Container -->\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"bg-background hover:bg-accent flex flex-1 items-center gap-2 rounded-md border p-2 transition-colors\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<!-- Sort Label -->\n\t\t\t\t\t\t\t\t<span class=\"text-muted-foreground min-w-[60px] text-sm\">\n\t\t\t\t\t\t\t\t\t{getSortLabel(index)}\n\t\t\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t\t\t<!-- Column Select -->\n\t\t\t\t\t\t\t\t<Select.Root\n\t\t\t\t\t\t\t\t\ttype=\"single\"\n\t\t\t\t\t\t\t\t\tvalue={sortRule.columnId}\n\t\t\t\t\t\t\t\t\tonValueChange={(value) => updateSortColumn(sortRule.id, value)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Select.Trigger class=\"h-8 flex-1\" size=\"sm\">\n\t\t\t\t\t\t\t\t\t\t<code class=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t{column ? getColumnHeaderValue(column, table) : \"Spalte auswählen\"}\n\t\t\t\t\t\t\t\t\t\t</code>\n\t\t\t\t\t\t\t\t\t</Select.Trigger>\n\t\t\t\t\t\t\t\t\t<Select.Content>\n\t\t\t\t\t\t\t\t\t\t{#each sortableCols as col (col.id)}\n\t\t\t\t\t\t\t\t\t\t\t{@const isUsed = draftSortRules.some(\n\t\t\t\t\t\t\t\t\t\t\t\t(r) => r.columnId === col.id && r.id !== sortRule.id\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t<Select.Item value={col.id} disabled={isUsed}>\n\t\t\t\t\t\t\t\t\t\t\t\t{getColumnHeaderValue(col, table)}\n\t\t\t\t\t\t\t\t\t\t\t</Select.Item>\n\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t</Select.Content>\n\t\t\t\t\t\t\t\t</Select.Root>\n\n\t\t\t\t\t\t\t\t<!-- Ascending Toggle -->\n\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t<label for={switchId} class=\"text-muted-foreground text-sm whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\tAufsteigend:\n\t\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\tid={switchId}\n\t\t\t\t\t\t\t\t\t\tchecked={ascending}\n\t\t\t\t\t\t\t\t\t\tonCheckedChange={(checked) => {\n\t\t\t\t\t\t\t\t\t\t\tdraftSortRules = draftSortRules.map((r) =>\n\t\t\t\t\t\t\t\t\t\t\t\tr.id === sortRule.id ? { ...r, desc: !checked } : r\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\taria-label={sortRule.desc ? \"Auf aufsteigend setzen\" : \"Auf absteigend setzen\"}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<!-- Remove Button -->\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tclass=\"h-8 w-8 p-0\"\n\t\t\t\t\t\t\t\tonclick={() => removeSortRule(sortRule.id)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<XIcon class=\"size-4\" />\n\t\t\t\t\t\t\t\t<span class=\"sr-only\">Sortierregel entfernen</span>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<!-- Add Sort Rule Button -->\n\t\t\t{#if draftSortRules.length < sortableCols.length}\n\t\t\t\t<Button variant=\"outline\" size=\"sm\" class=\"h-8 w-full border-dashed\" onclick={addSortRule}>\n\t\t\t\t\t<PlusIcon class=\"mr-1 size-4\" />\n\t\t\t\t\tWeitere Spalte zum Sortieren auswählen\n\t\t\t\t</Button>\n\t\t\t{/if}\n\n\t\t\t<!-- Actions -->\n\t\t\t<div class=\"flex items-center justify-between border-t pt-2\">\n\t\t\t\t{#if draftSortRules.length > 0}\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\tclass=\"text-destructive hover:text-destructive h-8\"\n\t\t\t\t\t\tonclick={removeAllSortRules}\n\t\t\t\t\t>\n\t\t\t\t\t\tSortierung entfernen\n\t\t\t\t\t</Button>\n\t\t\t\t{:else}\n\t\t\t\t\t<div></div>\n\t\t\t\t{/if}\n\t\t\t\t<Button size=\"sm\" class=\"h-8\" onclick={applySorting} disabled={!hasChanges}>\n\t\t\t\t\tSortierung anwenden\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\t</Popover.Content>\n</Popover.Root>\n\n<style>\n\t:global([data-id].dnd-sortable-drag-over) {\n\t\topacity: 0.5;\n\t}\n</style>\n",
			"type": "registry:component",
			"target": "blocks/data-table/data-table-sort-popover.svelte"
		},
		{
			"content": "<script lang=\"ts\" generics=\"TData\">\n\timport type { Table as TableType } from \"@tanstack/table-core\";\n\timport * as DropdownMenu from \"$lib/components/ui/dropdown-menu\";\n\timport { Button } from \"$lib/components/ui/button\";\n\timport ChevronLeftIcon from \"@lucide/svelte/icons/chevron-left\";\n\timport ChevronRightIcon from \"@lucide/svelte/icons/chevron-right\";\n\timport ChevronsLeftIcon from \"@lucide/svelte/icons/chevrons-left\";\n\timport ChevronsRightIcon from \"@lucide/svelte/icons/chevrons-right\";\n\timport CheckIcon from \"@lucide/svelte/icons/check\";\n\n\tlet {\n\t\ttable,\n\t\tincludePageSizeSelector = false,\n\t\tbuttonClass = \"h-8 px-3 text-sm\",\n\t\talign = \"end\",\n\t}: {\n\t\ttable: TableType<TData>;\n\t\tincludePageSizeSelector?: boolean;\n\t\tbuttonClass?: string;\n\t\talign?: \"start\" | \"end\" | \"center\";\n\t} = $props();\n</script>\n\n<div class=\"flex items-center gap-1\">\n\t<Button\n\t\tvariant=\"outline\"\n\t\tclass=\"size-8 p-0\"\n\t\tonclick={() => table.previousPage()}\n\t\tdisabled={!table.getCanPreviousPage()}\n\t>\n\t\t<span class=\"sr-only\">Go to previous page</span>\n\t\t<ChevronLeftIcon />\n\t</Button>\n\t<DropdownMenu.Root>\n\t\t<DropdownMenu.Trigger>\n\t\t\t<Button variant=\"outline\" class={buttonClass}>Seiten</Button>\n\t\t</DropdownMenu.Trigger>\n\t\t<DropdownMenu.Content {align}>\n\t\t\t<DropdownMenu.Item\n\t\t\t\tonclick={() => table.setPageIndex(0)}\n\t\t\t\tdisabled={!table.getCanPreviousPage()}\n\t\t\t>\n\t\t\t\t<ChevronsLeftIcon class=\"mr-2 size-4\" />\n\t\t\t\tErste Seite\n\t\t\t</DropdownMenu.Item>\n\t\t\t<DropdownMenu.Item\n\t\t\t\tonclick={() => table.setPageIndex(table.getPageCount() - 1)}\n\t\t\t\tdisabled={!table.getCanNextPage()}\n\t\t\t>\n\t\t\t\t<ChevronsRightIcon class=\"mr-2 size-4\" />\n\t\t\t\tLetzte Seite\n\t\t\t</DropdownMenu.Item>\n\t\t\t{#if includePageSizeSelector}\n\t\t\t\t<DropdownMenu.Separator />\n\t\t\t\t<DropdownMenu.Label>Zeilen pro Seite</DropdownMenu.Label>\n\t\t\t\t{#each [10, 20, 30, 40, 50] as pageSize (pageSize)}\n\t\t\t\t\t{@const isSelected = table.getState().pagination.pageSize === pageSize}\n\t\t\t\t\t<DropdownMenu.Item onclick={() => table.setPageSize(pageSize)} inset={true}>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclass=\"pointer-events-none absolute left-2 flex size-3.5 items-center justify-center\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if isSelected}\n\t\t\t\t\t\t\t\t<CheckIcon class=\"size-4\" />\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<CheckIcon class=\"size-4 text-transparent\" />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t{pageSize}\n\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t{/each}\n\t\t\t{/if}\n\t\t</DropdownMenu.Content>\n\t</DropdownMenu.Root>\n\t<Button\n\t\tvariant=\"outline\"\n\t\tclass=\"size-8 p-0\"\n\t\tonclick={() => table.nextPage()}\n\t\tdisabled={!table.getCanNextPage()}\n\t>\n\t\t<span class=\"sr-only\">Go to next page</span>\n\t\t<ChevronRightIcon />\n\t</Button>\n</div>\n",
			"type": "registry:component",
			"target": "blocks/data-table/data-table-pagination-menu.svelte"
		}
	]
}