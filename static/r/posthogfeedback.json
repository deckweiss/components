{
	"$schema": "https://shadcn-svelte.com/schema/registry-item.json",
	"name": "posthogfeedback",
	"title": "Posthog Feedback Button",
	"type": "registry:block",
	"description": "A feedback button integrated with Posthog",
	"dependencies": [
		"posthog-js",
		"lucide-svelte"
	],
	"devDependencies": [
		"@lucide/svelte@^0.515.0"
	],
	"registryDependencies": [
		"button",
		"dialog",
		"label",
		"select"
	],
	"files": [
		{
			"content": "import PosthogFeedbackButton from \"./posthogfeedback-button.svelte\";\n\nexport { PosthogFeedbackButton, PosthogFeedbackButton as Root };\n",
			"type": "registry:file",
			"target": "blocks/posthogfeedback/index.ts"
		},
		{
			"content": "import { browser } from '$app/environment';\nimport type { PostHog } from 'posthog-js';\n\n/**\n * Execute a callback with the PostHog instance.\n * @param callback - The callback to execute.\n * @example\n * ```ts\n * withPosthog((posthog) => {\n *     posthog.identify('user@example.com');\n * });\n * ```\n */\nexport async function withPosthog(callback: (posthog: PostHog) => void): Promise<void> {\n    if (browser) {\n        await import('posthog-js')\n            .then(({ default: posthog }) => {\n                try {\n                    callback(posthog);\n                } catch (error) {\n                    console.log('Failed to execute analytics callback:', error);\n                }\n            })\n            .catch((error) => {\n                console.log('Failed to load PostHog:', error);\n            });\n    }\n}\n\nexport function captureEvent(eventName: string, properties?: Record<string, any>) {\n    // Only capture events on the client side\n    withPosthog((posthog) => {\n        posthog.capture(eventName, properties);\n    });\n}\n",
			"type": "registry:file",
			"target": "blocks/posthogfeedback/analytics.ts"
		},
		{
			"content": "<script lang=\"ts\">\n\timport { browser } from \"$app/environment\";\n\timport { withPosthog } from \"./analytics\";\n\timport * as Dialog from \"$lib/components/ui/dialog\";\n\timport { Button } from \"$lib/components/ui/button\";\n\timport { Label } from \"$lib/components/ui/label\";\n\timport * as Select from \"$lib/components/ui/select\";\n\timport MessageCircle from \"@lucide/svelte/icons/message-circle\";\n\timport CheckCircle2 from \"@lucide/svelte/icons/check-circle-2\";\n\n\tinterface Props {\n\t\t/** The name of the app using this component (e.g., 'montageplaner', 'hr-manager') */\n\t\tappName?: string;\n\t\t/** Optional custom feedback types */\n\t\tfeedbackTypes?: Array<{ value: string; label: string; emoji: string }>;\n\t\t/** Optional custom button position */\n\t\tposition?: \"bottom-right\" | \"bottom-left\" | \"top-right\" | \"top-left\";\n\t}\n\n\tlet {\n\t\tappName = \"montageplaner\",\n\t\tfeedbackTypes: customFeedbackTypes,\n\t\tposition = \"bottom-right\",\n\t}: Props = $props();\n\n\tlet dialogOpen = $state(false);\n\tlet feedbackType = $state<string>(\"comment\");\n\tlet feedbackText = $state(\"\");\n\tlet isSubmitting = $state(false);\n\tlet showSuccess = $state(false);\n\n\tconst defaultFeedbackTypes = [\n\t\t{ value: \"bug\", label: \"Fehler melden\", emoji: \"üêõ\" },\n\t\t{ value: \"feature\", label: \"Feature-Anfrage\", emoji: \"‚ú®\" },\n\t\t{ value: \"comment\", label: \"Kommentar\", emoji: \"üí¨\" },\n\t];\n\n\tconst feedbackTypes = customFeedbackTypes || defaultFeedbackTypes;\n\n\tconst positionClasses = {\n\t\t\"bottom-right\": \"bottom-4 right-4\",\n\t\t\"bottom-left\": \"bottom-4 left-4\",\n\t\t\"top-right\": \"top-4 right-4\",\n\t\t\"top-left\": \"top-4 left-4\",\n\t};\n\n\tfunction handleOpen() {\n\t\tdialogOpen = true;\n\t\tfeedbackText = \"\";\n\t\tfeedbackType = \"comment\";\n\t\tshowSuccess = false;\n\t}\n\n\tasync function handleSubmit() {\n\t\tif (!feedbackText.trim()) {\n\t\t\treturn;\n\t\t}\n\n\t\tisSubmitting = true;\n\n\t\t// Capture the feedback values before clearing them\n\t\tconst feedbackToSend = feedbackText.trim();\n\t\tconst typeToSend = feedbackType;\n\n\t\ttry {\n\t\t\t// Send feedback to PostHog\n\t\t\tawait withPosthog((posthog) => {\n\t\t\t\tconst eventProperties = {\n\t\t\t\t\ttype: typeToSend,\n\t\t\t\t\tfeedback: feedbackToSend,\n\t\t\t\t\tsource: \"feedback_button\",\n\t\t\t\t\tapp: appName,\n\t\t\t\t};\n\t\t\t\tposthog.capture(\"feedback_submitted\", eventProperties);\n\t\t\t});\n\n\t\t\t// Show success message\n\t\t\tshowSuccess = true;\n\t\t\tfeedbackText = \"\";\n\n\t\t\t// Close dialog after 1.5 seconds\n\t\t\tsetTimeout(() => {\n\t\t\t\tdialogOpen = false;\n\t\t\t\tshowSuccess = false;\n\t\t\t}, 1500);\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to submit feedback:\", error);\n\t\t} finally {\n\t\t\tisSubmitting = false;\n\t\t}\n\t}\n\n\tfunction handleClose() {\n\t\tdialogOpen = false;\n\t\tfeedbackText = \"\";\n\t\tfeedbackType = \"comment\";\n\t\tshowSuccess = false;\n\t}\n\n\t// Reset form when dialog closes\n\t$effect(() => {\n\t\tif (!dialogOpen) {\n\t\t\tfeedbackText = \"\";\n\t\t\tfeedbackType = \"comment\";\n\t\t\tshowSuccess = false;\n\t\t\tisSubmitting = false;\n\t\t}\n\t});\n</script>\n\n<Dialog.Root bind:open={dialogOpen}>\n\t<Button\n\t\ttype=\"button\"\n\t\tonclick={handleOpen}\n\t\tclass=\"group absolute {positionClasses[\n\t\t\tposition\n\t\t]} z-50 flex h-12 min-w-12 items-center justify-center gap-0 overflow-hidden rounded-full bg-blue-600 p-0 text-white shadow-lg transition-[width,gap,padding] duration-300 ease-in-out hover:min-w-[120px] hover:justify-start hover:gap-2 hover:px-4\"\n\t\taria-label=\"Feedback senden\"\n\t>\n\t\t<MessageCircle class=\"size-5 shrink-0\" />\n\t\t<span\n\t\t\tclass=\"max-w-0 overflow-hidden font-medium whitespace-nowrap opacity-0 transition-[max-width,opacity] duration-300 ease-in-out group-hover:max-w-[200px] group-hover:opacity-100\"\n\t\t\t>Feedback</span\n\t\t>\n\t</Button>\n\n\t<Dialog.Content>\n\t\t<Dialog.Header>\n\t\t\t<Dialog.Title>Feedback senden</Dialog.Title>\n\t\t\t<Dialog.Description>Teile uns deine Meinung mit</Dialog.Description>\n\t\t</Dialog.Header>\n\n\t\t{#if showSuccess}\n\t\t\t<div class=\"flex flex-col items-center justify-center gap-4 py-8\">\n\t\t\t\t<CheckCircle2 class=\"size-12 text-green-600\" />\n\t\t\t\t<div class=\"space-y-1 text-center\">\n\t\t\t\t\t<p class=\"text-lg font-medium\">Vielen Dank!</p>\n\t\t\t\t\t<p class=\"text-muted-foreground text-sm\">Dein Feedback wurde erfolgreich √ºbermittelt.</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div class=\"space-y-4 py-4\">\n\t\t\t\t<div class=\"space-y-2\">\n\t\t\t\t\t<Label for=\"feedback-type\">Art des Feedbacks</Label>\n\t\t\t\t\t<Select.Root type=\"single\" bind:value={feedbackType}>\n\t\t\t\t\t\t<Select.Trigger id=\"feedback-type\">\n\t\t\t\t\t\t\t{#if feedbackType}\n\t\t\t\t\t\t\t\t{@const selectedType = feedbackTypes.find((t) => t.value === feedbackType)}\n\t\t\t\t\t\t\t\t{#if selectedType}\n\t\t\t\t\t\t\t\t\t<span class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t<span>{selectedType.emoji}</span>\n\t\t\t\t\t\t\t\t\t\t<span>{selectedType.label}</span>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\tArt ausw√§hlen\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<span class=\"text-muted-foreground\">Art ausw√§hlen</span>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</Select.Trigger>\n\t\t\t\t\t\t<Select.Content>\n\t\t\t\t\t\t\t{#each feedbackTypes as type}\n\t\t\t\t\t\t\t\t<Select.Item value={type.value} label={type.label}>\n\t\t\t\t\t\t\t\t\t<span class=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t<span>{type.emoji}</span>\n\t\t\t\t\t\t\t\t\t\t<span>{type.label}</span>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</Select.Item>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</Select.Content>\n\t\t\t\t\t</Select.Root>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"space-y-2\">\n\t\t\t\t\t<Label for=\"feedback-text\">Dein Feedback</Label>\n\t\t\t\t\t<textarea\n\t\t\t\t\t\tid=\"feedback-text\"\n\t\t\t\t\t\tbind:value={feedbackText}\n\t\t\t\t\t\tplaceholder=\"Beschreibe dein Feedback...\"\n\t\t\t\t\t\tclass=\"border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring min-h-[120px] w-full rounded-md border px-3 py-2 text-sm focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50\"\n\t\t\t\t\t\tdisabled={isSubmitting}\n\t\t\t\t\t></textarea>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<Dialog.Footer>\n\t\t\t\t<Button variant=\"outline\" onclick={handleClose} disabled={isSubmitting}>Abbrechen</Button>\n\t\t\t\t<Button onclick={handleSubmit} disabled={isSubmitting || !feedbackText.trim()}>\n\t\t\t\t\t{isSubmitting ? \"Wird gesendet...\" : \"Senden\"}\n\t\t\t\t</Button>\n\t\t\t</Dialog.Footer>\n\t\t{/if}\n\t</Dialog.Content>\n</Dialog.Root>\n",
			"type": "registry:component",
			"target": "blocks/posthogfeedback/posthogfeedback-button.svelte"
		}
	]
}